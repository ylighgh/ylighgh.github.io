<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Kubernetes安装</title>
    <link href="/hexo/2024/05/28/Kubernetes%E5%AE%89%E8%A3%85/"/>
    <url>/hexo/2024/05/28/Kubernetes%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">hostnamectl set-hostname k8s-node<br><br>modprobe overlay<br>modprobe br_netfilter<br><br>cat &lt;&lt;EOF&gt; /etc/modules-load.d/containerd.conf<br>overlay<br>br_netfilter<br>EOF<br><br>cat &lt;&lt;EOF&gt; /etc/sysctl.d/<span class="hljs-number">99</span>-kubernetes-cri.conf<br>net.bridge.bridge-nf-call-iptables = <span class="hljs-number">1</span><br>net.ipv4.ip_forward = <span class="hljs-number">1</span><br>net.bridge.bridge-nf-call-ip6tables = <span class="hljs-number">1</span><br>EOF<br><br>cat &lt;&lt;EOF&gt;&gt; /etc/hosts<br><span class="hljs-number">192.168.10.242</span> k8s-master<br><span class="hljs-number">192.168.10.245</span> k8s-node1<br><span class="hljs-number">192.168.10.246</span> k8s-node2<br><span class="hljs-number">192.168.10.247</span> k8s-node3<br>EOF<br><br>sysctl --system<br><br>systemctl stop firewalld<br>systemctl disable firewalld<br>systemctl unmask firewalld<br></code></pre></td></tr></table></figure><h2 id="安装Containerd"><a href="#安装Containerd" class="headerlink" title="安装Containerd"></a>安装Containerd</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim">dnf config-manager --<span class="hljs-built_in">add</span>-repo=https://download.docker.<span class="hljs-keyword">com</span>/linux/centos/docker-<span class="hljs-keyword">ce</span>.repo<br>dnf <span class="hljs-keyword">update</span><br>dnf install -<span class="hljs-keyword">y</span> containerd<br></code></pre></td></tr></table></figure><h2 id="配置Containerd"><a href="#配置Containerd" class="headerlink" title="配置Containerd"></a>配置Containerd</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs swift">mkdir <span class="hljs-operator">-</span>p <span class="hljs-regexp">/etc/</span>containerd<br>containerd config <span class="hljs-keyword">default</span> <span class="hljs-operator">&gt;</span> <span class="hljs-regexp">/etc/</span>containerd<span class="hljs-operator">/</span>config.toml<br><br>sed <span class="hljs-operator">-</span>i &#x27;s<span class="hljs-regexp">/SystemdCgroup = false/</span><span class="hljs-type">SystemdCgroup</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span><span class="hljs-regexp">/g&#x27; /</span>etc<span class="hljs-regexp">/containerd/</span>config.toml<br></code></pre></td></tr></table></figure><h2 id="重启containerd"><a href="#重启containerd" class="headerlink" title="重启containerd"></a>重启containerd</h2><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-params">system</span>ctl daemon-reload<br><span class="hljs-params">system</span>ctl restart containerd<br><span class="hljs-params">system</span>ctl enable --now containerd<br><span class="hljs-params">system</span>ctl status containerd<br></code></pre></td></tr></table></figure><h2 id="安装kubeadm"><a href="#安装kubeadm" class="headerlink" title="安装kubeadm"></a>安装kubeadm</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs routeros">cat &lt;&lt;EOF&gt;/etc/yum.repos.d/kubernetes.repo<br>[kubernetes]<br><span class="hljs-attribute">name</span>=Kubernetes<br><span class="hljs-attribute">baseurl</span>=https://pkgs.k8s.io/core:/stable:/v1.30/rpm/<br><span class="hljs-attribute">enabled</span>=1<br><span class="hljs-attribute">gpgcheck</span>=1<br><span class="hljs-attribute">gpgkey</span>=https://pkgs.k8s.io/core:/stable:/v1.30/rpm/repodata/repomd.xml.key<br><span class="hljs-attribute">exclude</span>=kubelet kubeadm kubectl cri-tools kubernetes-cni<br>EOF<br><br>dnf install -y kubelet kubeadm kubectl <span class="hljs-attribute">--disableexcludes</span>=kubernetes<br><br>systemctl <span class="hljs-built_in">enable</span> --now kubelet<br></code></pre></td></tr></table></figure><h2 id="master节点执行"><a href="#master节点执行" class="headerlink" title="master节点执行"></a>master节点执行</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros">kubeadm init \<br><span class="hljs-attribute">--apiserver-advertise-address</span>=192.168.10.242 \<br>--image-repository registry.aliyuncs.com/google_containers \<br><span class="hljs-attribute">--service-cidr</span>=10.96.0.0/12 \<br><span class="hljs-attribute">--pod-network-cidr</span>=10.244.0.0/16<br></code></pre></td></tr></table></figure><p>执行成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$HOME</span>/.kube<br><span class="hljs-built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="hljs-variable">$HOME</span>/.kube/config<br><span class="hljs-built_in">chown</span> $(<span class="hljs-built_in">id</span> -u):$(<span class="hljs-built_in">id</span> -g) <span class="hljs-variable">$HOME</span>/.kube/config<br><span class="hljs-built_in">export</span> KUBECONFIG=/etc/kubernetes/admin.conf<br></code></pre></td></tr></table></figure><h2 id="将其他node加入集群"><a href="#将其他node加入集群" class="headerlink" title="将其他node加入集群"></a>将其他node加入集群</h2><p>在其他节点执行</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">kubeadm <span class="hljs-keyword">join </span><span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">10</span>.<span class="hljs-number">242</span>:<span class="hljs-number">6443</span> --token ijblbd.<span class="hljs-keyword">bmnaf8xcl38iwxbz </span>\<br>--<span class="hljs-keyword">discovery-token-ca-cert-hash </span><span class="hljs-keyword">sha256:1d76ad35d2d95c6b381ada3d03b15f230201e9e0af41db4db33700d7de604e1d </span><br></code></pre></td></tr></table></figure><h2 id="部署CNI网络组件"><a href="#部署CNI网络组件" class="headerlink" title="部署CNI网络组件"></a>部署CNI网络组件</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget https:<span class="hljs-regexp">//</span>docs.projectcalico.org<span class="hljs-regexp">/manifests/</span>calico.yaml<br><br>- 修改IPV4POOL地址<br><br>kubectl create -f calico.yaml<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Kubernetes</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
