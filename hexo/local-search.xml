<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Kubernetes-EndPoint使用示例</title>
    <link href="/hexo/2024/05/29/Kubernetes-EndPoint%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B/"/>
    <url>/hexo/2024/05/29/Kubernetes-EndPoint%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="创建service"><a href="#创建service" class="headerlink" title="创建service"></a>创建service</h1><div class="code-wrapper"><pre><code class="hljs bash">kubect apply -f - &lt;&lt;<span class="hljs-string">EOF</span><span class="hljs-string">apiVersion: v1</span><span class="hljs-string">kind: Service</span><span class="hljs-string">metadata:</span><span class="hljs-string">  name: axzo-test-rds-master</span><span class="hljs-string">  namespace: test</span><span class="hljs-string">spec:</span><span class="hljs-string">  ports:</span><span class="hljs-string">  - port: 3306</span><span class="hljs-string">    protocol: TCP</span><span class="hljs-string">    targetPort: 3306</span><span class="hljs-string">  sessionAffinity: None</span><span class="hljs-string">  type: ClusterIP</span><span class="hljs-string">EOF</span></code></pre></div><h1 id="创建Endpoint"><a href="#创建Endpoint" class="headerlink" title="创建Endpoint"></a>创建Endpoint</h1><div class="code-wrapper"><pre><code class="hljs bash">kubect apply -f - &lt;&lt;<span class="hljs-string">EOF</span><span class="hljs-string">apiVersion: v1</span><span class="hljs-string">kind: Endpoints</span><span class="hljs-string">metadata:</span><span class="hljs-string">  name: axzo-test-rds-master</span><span class="hljs-string">  namespace: test</span><span class="hljs-string">subsets:</span><span class="hljs-string">- addresses:</span><span class="hljs-string">  - ip: 172.16.2.143</span><span class="hljs-string">  ports:</span><span class="hljs-string">  - port: 3306</span><span class="hljs-string">    protocol: TCP</span><span class="hljs-string">EOF</span></code></pre></div>]]></content>
    
    
    
    <tags>
      
      <tag>Kubernetes</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kubernetes-安装</title>
    <link href="/hexo/2024/05/28/Kubernetes-%E5%AE%89%E8%A3%85/"/>
    <url>/hexo/2024/05/28/Kubernetes-%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><div class="code-wrapper"><pre><code class="hljs bash">hostnamectl set-hostname k8s-nodemodprobe overlaymodprobe br_netfilter<span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF&gt; /etc/modules-load.d/containerd.conf</span><span class="hljs-string">overlay</span><span class="hljs-string">br_netfilter</span><span class="hljs-string">EOF</span><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF&gt; /etc/sysctl.d/99-kubernetes-cri.conf</span><span class="hljs-string">net.bridge.bridge-nf-call-iptables = 1</span><span class="hljs-string">net.ipv4.ip_forward = 1</span><span class="hljs-string">net.bridge.bridge-nf-call-ip6tables = 1</span><span class="hljs-string">EOF</span><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF&gt;&gt; /etc/hosts</span><span class="hljs-string">192.168.10.242 k8s-master</span><span class="hljs-string">192.168.10.245 k8s-node1</span><span class="hljs-string">192.168.10.246 k8s-node2</span><span class="hljs-string">192.168.10.247 k8s-node3</span><span class="hljs-string">EOF</span>sysctl --systemsystemctl stop firewalldsystemctl <span class="hljs-built_in">disable</span> firewalldsystemctl unmask firewalld</code></pre></div><h2 id="安装Containerd"><a href="#安装Containerd" class="headerlink" title="安装Containerd"></a>安装Containerd</h2><div class="code-wrapper"><pre><code class="hljs bash">dnf config-manager --add-repo=https://download.docker.com/linux/centos/docker-ce.repodnf updatednf install -y containerd</code></pre></div><h2 id="配置Containerd"><a href="#配置Containerd" class="headerlink" title="配置Containerd"></a>配置Containerd</h2><div class="code-wrapper"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /etc/containerdcontainerd config default &gt; /etc/containerd/config.tomlsed -i <span class="hljs-string">&#x27;s/SystemdCgroup = false/SystemdCgroup = true/g&#x27;</span> /etc/containerd/config.toml</code></pre></div><h2 id="重启containerd"><a href="#重启containerd" class="headerlink" title="重启containerd"></a>重启containerd</h2><div class="code-wrapper"><pre><code class="hljs bash">systemctl daemon-reloadsystemctl restart containerdsystemctl <span class="hljs-built_in">enable</span> --now containerdsystemctl status containerd</code></pre></div><h2 id="安装kubeadm"><a href="#安装kubeadm" class="headerlink" title="安装kubeadm"></a>安装kubeadm</h2><div class="code-wrapper"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF&gt;/etc/yum.repos.d/kubernetes.repo</span><span class="hljs-string">[kubernetes]</span><span class="hljs-string">name=Kubernetes</span><span class="hljs-string">baseurl=https://pkgs.k8s.io/core:/stable:/v1.30/rpm/</span><span class="hljs-string">enabled=1</span><span class="hljs-string">gpgcheck=1</span><span class="hljs-string">gpgkey=https://pkgs.k8s.io/core:/stable:/v1.30/rpm/repodata/repomd.xml.key</span><span class="hljs-string">exclude=kubelet kubeadm kubectl cri-tools kubernetes-cni</span><span class="hljs-string">EOF</span>dnf install -y kubelet kubeadm kubectl --disableexcludes=kubernetessystemctl <span class="hljs-built_in">enable</span> --now kubelet</code></pre></div><h2 id="master节点执行"><a href="#master节点执行" class="headerlink" title="master节点执行"></a>master节点执行</h2><div class="code-wrapper"><pre><code class="hljs bash">kubeadm init \--apiserver-advertise-address=192.168.10.242 \--image-repository registry.aliyuncs.com/google_containers \--service-cidr=10.96.0.0/12 \--pod-network-cidr=10.244.0.0/16</code></pre></div><p>执行成功</p><div class="code-wrapper"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$HOME</span>/.kube<span class="hljs-built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="hljs-variable">$HOME</span>/.kube/config<span class="hljs-built_in">chown</span> $(<span class="hljs-built_in">id</span> -u):$(<span class="hljs-built_in">id</span> -g) <span class="hljs-variable">$HOME</span>/.kube/config<span class="hljs-built_in">export</span> KUBECONFIG=/etc/kubernetes/admin.conf</code></pre></div><h2 id="将其他node加入集群"><a href="#将其他node加入集群" class="headerlink" title="将其他node加入集群"></a>将其他node加入集群</h2><p>在其他节点执行</p><div class="code-wrapper"><pre><code class="hljs bash">kubeadm <span class="hljs-built_in">join</span> 192.168.10.242:6443 --token ijblbd.bmnaf8xcl38iwxbz \--discovery-token-ca-cert-hash sha256:1d76ad35d2d95c6b381ada3d03b15f230201e9e0af41db4db33700d7de604e1d</code></pre></div><h2 id="部署CNI网络组件"><a href="#部署CNI网络组件" class="headerlink" title="部署CNI网络组件"></a>部署CNI网络组件</h2><div class="code-wrapper"><pre><code class="hljs bash">wget https://docs.projectcalico.org/manifests/calico.yaml- 修改IPV4POOL地址kubectl create -f calico.yaml</code></pre></div>]]></content>
    
    
    
    <tags>
      
      <tag>Kubernetes</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
