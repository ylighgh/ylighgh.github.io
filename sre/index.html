<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<meta name="author" content="尹三石">
<title>杂记</title>
<style>
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: rgba(0, 0, 0, 0.8); padding: 0; margin: 0; font-family: "Noto Serif", "DejaVu Serif", serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

object, svg { display: inline-block; vertical-align: middle; }

.center { margin-left: auto; margin-right: auto; }

.spread { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.45; color: #7a2518; font-weight: normal; margin-top: 0; margin-bottom: 0.25em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #2156a5; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #1d4b8f; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Open Sans", "DejaVu Sans", sans-serif; font-weight: 300; font-style: normal; color: #ba3925; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.0125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #e99b8f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #ddddd8; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace; font-weight: normal; color: rgba(0, 0, 0, 0.9); }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 1.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: rgba(0, 0, 0, 0.8); border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.9375em; color: rgba(0, 0, 0, 0.6); }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: rgba(0, 0, 0, 0.6); }

blockquote, blockquote p { line-height: 1.6; color: rgba(0, 0, 0, 0.85); }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dedede; }
table thead, table tfoot { background: #f7f8f7; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: rgba(0, 0, 0, 0.8); text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: rgba(0, 0, 0, 0.8); }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f8f8f7; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }

body { tab-size: 4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; word-spacing: -0.05em; }
h1 strong, h2 strong, h3 strong, #toctitle strong, .sidebarblock > .content > .title strong, h4 strong, h5 strong, h6 strong { font-weight: 400; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: 0.9375em; font-style: normal !important; letter-spacing: 0; padding: 0.1em 0.5ex; word-spacing: -0.15em; background-color: #f7f7f8; -webkit-border-radius: 4px; border-radius: 4px; line-height: 1.45; text-rendering: optimizeSpeed; border: 1px dashed #2f6fab;}

pre {border: 1px dashed gray;}

pre, pre > code { line-height: 1.45; color: rgba(0, 0, 0, 0.9); font-family: "Droid Sans Mono", "DejaVu Sans Mono", "Monospace", monospace; font-weight: normal; text-rendering: optimizeSpeed;}

.keyseq { color: rgba(51, 51, 51, 0.8); }

kbd { font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace; display: inline-block; color: rgba(0, 0, 0, 0.8); font-size: 0.65em; line-height: 1.45; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: 0 0.15em; padding: 0.2em 0.5em; vertical-align: middle; position: relative; top: -0.1em; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: rgba(0, 0, 0, 0.8); }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

p a > code:hover { color: rgba(0, 0, 0, 0.9); }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: rgba(0, 0, 0, 0.85); margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #ddddd8; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #ddddd8; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #ddddd8; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: rgba(0, 0, 0, 0.6); display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: rgba(0, 0, 0, 0.85); }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: rgba(0, 0, 0, 0.85); }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: rgba(0, 0, 0, 0.85); border-bottom: 1px solid #ddddd8; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 1px solid #efefed; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Open Sans", "DejaVu Sans", sans-serif; list-style-type: none; }
#toc li { line-height: 1.3334; margin-top: 0.3334em; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #7a2518; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f8f8f7; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #efefed; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; margin-bottom: 0.8rem; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #efefed; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #e0e0dc; margin-bottom: 1.25em; padding: 1.25em; background: #f8f8f7; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: rgba(0, 0, 0, 0.8); padding: 1.25em; }

#footer-text { color: rgba(255, 255, 255, 0.8); line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #efefed; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #ba3925; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #a53221; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; font-family: "Noto Serif", "DejaVu Serif", serif; font-size: 1rem; font-style: italic; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: rgba(0, 0, 0, 0.85); }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Open Sans", "DejaVu Sans", sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #ddddd8; color: rgba(0, 0, 0, 0.6); }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #e0e0dc; margin-bottom: 1.25em; padding: 1.25em; background: #f8f8f7; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #7a2518; margin-top: 0; text-align: center; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.listingblock pre:not(.highlight) {color: white; background: #002b36; }

.literalblock pre, .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #f7f7f8; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { -webkit-border-radius: 4px; border-radius: 4px; word-wrap: break-word; padding: 1em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #f7f7f8; background-color: rgba(0, 0, 0, 0.9); }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 1em; -webkit-border-radius: 4px; border-radius: 4px; }

.listingblock pre.prettyprint { border-width: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; line-height: 1.45; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #ddddd8; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: rgba(0, 0, 0, 0.85); font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #7a2518; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid rgba(0, 0, 0, 0.6); }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: rgba(0, 0, 0, 0.85); font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.9375em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.025em; color: rgba(0, 0, 0, 0.6); }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dedede; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.6; background: #f7f8f7; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: rgba(0, 0, 0, 0.8); font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1em; font-size: 0.85em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { width: 1em; position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1, td.hdlist2 { vertical-align: top; padding: 0 0.625em; }

td.hdlist1 { font-weight: bold; padding-bottom: 1.25em; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; display: inline-block; }
a.image object { pointer-events: none; }

sup.footnote, sup.footnoteref { font-size: 0.875em; position: static; vertical-align: super; }
sup.footnote a, sup.footnoteref a { text-decoration: none; }
sup.footnote a:active, sup.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -0.25em 0 0.75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em 0 0.225em; line-height: 1.3334; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.05em; margin-bottom: 0.2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #19407c; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: rgba(0, 0, 0, 0.8); -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

dt, th.tableblock, td.content, div.footnote { text-rendering: optimizeLegibility; }

h1, h2, p, td.content, span.alt { letter-spacing: -0.01em; }

p strong, td.content strong, div.footnote strong { letter-spacing: -0.005em; }

p, blockquote, dt, td.content, span.alt { font-size: 1.0625rem; }

p { margin-bottom: 1.25rem; }

.sidebarblock p, .sidebarblock dt, .sidebarblock td.content, p.tableblock { font-size: 1em; }

.exampleblock > .content { background-color: #fffef7; border-color: #e0e0dc; -webkit-box-shadow: 0 1px 4px #e0e0dc; box-shadow: 0 1px 4px #e0e0dc; }

.print-only { display: none !important; }

@media print { @page { margin: 1.25cm 0.75cm; }
  * { -webkit-box-shadow: none !important; box-shadow: none !important; text-shadow: none !important; }
  a { color: inherit !important; text-decoration: underline !important; }
  a.bare, a[href^="#"], a[href^="mailto:"] { text-decoration: none !important; }
  a[href^="http:"]:not(.bare):after, a[href^="https:"]:not(.bare):after { content: "(" attr(href) ")"; display: inline-block; font-size: 0.875em; padding-left: 0.25em; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  pre, blockquote, tr, img, object, svg { page-break-inside: avoid; }
  thead { display: table-header-group; }
  svg { max-width: 100%; }
  p, blockquote, dt, td.content { font-size: 1em; orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  #toc, .sidebarblock, .exampleblock > .content { background: none !important; }
  #toc { border-bottom: 1px solid #ddddd8 !important; padding-bottom: 0 !important; }
  .sect1 { padding-bottom: 0 !important; }
  .sect1 + .sect1 { border: 0 !important; }
  #header > h1:first-child { margin-top: 1.25rem; }
  body.book #header { text-align: center; }
  body.book #header > h1:first-child { border: 0 !important; margin: 2.5em 0 1em 0; }
  body.book #header .details { border: 0 !important; display: block; padding: 0 !important; }
  body.book #header .details span:first-child { margin-left: 0 !important; }
  body.book #header .details br { display: block; }
  body.book #header .details br + span:before { content: none !important; }
  body.book #toc { border: 0 !important; text-align: left !important; padding: 0 !important; margin: 0 !important; }
  body.book #toc, body.book #preamble, body.book h1.sect0, body.book .sect1 > h2 { page-break-before: always; }
  .listingblock code[data-lang]:before { display: block; }
  #footer { background: none !important; padding: 0 0.9375em; }
  #footer-text { color: rgba(0, 0, 0, 0.6) !important; font-size: 0.9em; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }

</style>
<link rel="stylesheet" href="css/font-awesome.css">
<link rel="stylesheet" href="css/github.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>杂记</h1>
<div class="details">
<span id="author" class="author">尹三石</span><br>
<span id="email" class="email"><a href="mailto:yssuvu@gmail.com">yssuvu@gmail.com</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">目录</div>
<ul class="sectlevel1">
<li><a href="#_前言">前言</a></li>
<li><a href="#_Linux_chapter">1. Linux</a>
<ul class="sectlevel2">
<li><a href="#_系统服务">1.1. 系统服务</a>
<ul class="sectlevel3">
<li><a href="#_计划任务">1.1.1. 计划任务</a></li>
</ul>
</li>
<li><a href="#_ssh">1.2. SSH</a>
<ul class="sectlevel3">
<li><a href="#_无密钥登陆">1.2.1. 无密钥登陆</a></li>
</ul>
</li>
<li><a href="#_时间同步">1.3. 时间同步</a></li>
<li><a href="#_proxychains">1.4. Proxychains</a></li>
</ul>
</li>
<li><a href="#_Python_chapter">2. CentOS</a>
<ul class="sectlevel2">
<li><a href="#_python38">2.1. Python38</a></li>
<li><a href="#_php7">2.2. PHP7</a></li>
</ul>
</li>
<li><a href="#_Nginx_chapter">3. Nginx</a>
<ul class="sectlevel2">
<li><a href="#_安装">3.1. 安装</a></li>
<li><a href="#_常用功能">3.2. 常用功能</a>
<ul class="sectlevel3">
<li><a href="#_反向代理">3.2.1. 反向代理</a></li>
<li><a href="#_负载均衡">3.2.2. 负载均衡</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_Zabbix_chapter">4. Zabbix</a>
<ul class="sectlevel2">
<li><a href="#_安装_2">4.1. 安装</a></li>
<li><a href="#_卸载">4.2. 卸载</a></li>
<li><a href="#_添加主机">4.3. 添加主机</a></li>
</ul>
</li>
<li><a href="#_Jenkins_chapter">5. Jenkins</a>
<ul class="sectlevel2">
<li><a href="#_安装_3">5.1. 安装</a></li>
<li><a href="#_插件">5.2. 插件</a></li>
<li><a href="#_pipeline">5.3. PipeLine</a></li>
</ul>
</li>
<li><a href="#_RabbitMQ_chapter">6. RabbitMQ</a></li>
<li><a href="#_Kafka_chapter">7. Kafka</a></li>
<li><a href="#_Gitlab_chapter">8. Gitlab</a>
<ul class="sectlevel2">
<li><a href="#_安装_4">8.1. 安装</a></li>
<li><a href="#_nginx反代gitlab">8.2. Nginx反代GitLab</a>
<ul class="sectlevel3">
<li><a href="#_gitlab设置">8.2.1. GitLab设置</a></li>
<li><a href="#_nginx_server配置">8.2.2. Nginx Server配置</a></li>
<li><a href="#_设置http_clone相关参数">8.2.3. 设置HTTP Clone相关参数</a></li>
<li><a href="#_最后">8.2.4. 最后</a></li>
</ul>
</li>
<li><a href="#_gitlab邮件服务">8.3. GitLab邮件服务</a></li>
<li><a href="#_常用命令">8.4. 常用命令</a></li>
</ul>
</li>
<li><a href="#_Git_chapter">9. Git</a>
<ul class="sectlevel2">
<li><a href="#_系统设置">9.1. 系统设置</a></li>
<li><a href="#_基本命令">9.2. 基本命令</a>
<ul class="sectlevel3">
<li><a href="#_文件操作">9.2.1. 文件操作</a></li>
<li><a href="#_分支管理">9.2.2. 分支管理</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_MySQL_chapter">10. MySQL</a>
<ul class="sectlevel2">
<li><a href="#_安装_5">10.1. 安装</a></li>
<li><a href="#_常用命令_2">10.2. 常用命令</a>
<ul class="sectlevel3">
<li><a href="#_创建用户开放指定host登录">10.2.1. 创建用户、开放指定HOST登录</a></li>
<li><a href="#_用户授权">10.2.2. 用户授权</a></li>
<li><a href="#_备份与还原">10.2.3. 备份与还原</a></li>
<li><a href="#_创建数据库时指定字符集">10.2.4. 创建数据库时指定字符集</a></li>
<li><a href="#_字符集">10.2.5. 字符集</a></li>
</ul>
</li>
<li><a href="#_mysql集群">10.3. MySQL集群</a>
<ul class="sectlevel3">
<li><a href="#_主从备份">10.3.1. 主从备份</a></li>
<li><a href="#_主主备份">10.3.2. 主主备份</a></li>
<li><a href="#_多主一从">10.3.3. 多主一从</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_Redis_chapter">11. Redis</a>
<ul class="sectlevel2">
<li><a href="#_安装配置">11.1. 安装配置</a></li>
<li><a href="#_常用命令_3">11.2. 常用命令</a>
<ul class="sectlevel3">
<li><a href="#_键key">11.2.1. 键(Key)</a></li>
<li><a href="#_字符串string">11.2.2. 字符串(String)</a></li>
<li><a href="#_哈希表hash">11.2.3. 哈希表(Hash)</a></li>
<li><a href="#_列表list">11.2.4. 列表(List)</a></li>
<li><a href="#_集合set">11.2.5. 集合(Set)</a></li>
</ul>
</li>
<li><a href="#_高级应用">11.3. 高级应用</a>
<ul class="sectlevel3">
<li><a href="#_密码防护">11.3.1. 密码防护</a></li>
<li><a href="#_主从备份_2">11.3.2. 主从备份</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_Rsync_chapter">12. Rsync</a>
<ul class="sectlevel2">
<li><a href="#_数据传输">12.1. 数据传输</a></li>
<li><a href="#_实时同步">12.2. 实时同步</a></li>
<li><a href="#_客户端服务器模式">12.3. 客户端服务器模式</a></li>
</ul>
</li>
<li><a href="#_Java_chapter">13. Java</a>
<ul class="sectlevel2">
<li><a href="#_java_web">13.1. Java_web</a>
<ul class="sectlevel3">
<li><a href="#_jdk">13.1.1. JDK</a>
<ul class="sectlevel4">
<li><a href="#_源码包安装">源码包安装</a></li>
</ul>
</li>
<li><a href="#_tomcat">13.1.2. Tomcat</a>
<ul class="sectlevel4">
<li><a href="#_源码包安装_2">源码包安装</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ElasticSearch_chapter">14. ElasticStack</a>
<ul class="sectlevel2">
<li><a href="#_elk环境配置">14.1. ELK环境配置</a>
<ul class="sectlevel3">
<li><a href="#_elasticsearch">14.1.1. ElasticSearch</a></li>
<li><a href="#_kibana">14.1.2. Kibana</a></li>
<li><a href="#_logstash">14.1.3. LogStash</a></li>
</ul>
</li>
<li><a href="#_nginx日志分析">14.2. Nginx日志分析</a>
<ul class="sectlevel3">
<li><a href="#_filebeat实时导入">14.2.1. FileBeat实时导入</a></li>
<li><a href="#_nginx日志普通导入">14.2.2. Nginx日志普通导入</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_Docker_chapter">15. Docker</a>
<ul class="sectlevel2">
<li><a href="#_安装_6">15.1. 安装</a></li>
<li><a href="#_基本使用">15.2. 基本使用</a></li>
<li><a href="#_私服镜像">15.3. 私服镜像</a></li>
<li><a href="#_容器数据卷">15.4. 容器数据卷</a></li>
<li><a href="#_程序启动命令汇总">15.5. 程序启动命令汇总</a>
<ul class="sectlevel3">
<li><a href="#_tomcat_2">15.5.1. Tomcat</a></li>
<li><a href="#_redis">15.5.2. Redis</a></li>
<li><a href="#_mysql">15.5.3. MySQL</a></li>
</ul>
</li>
<li><a href="#_mysql主从">15.6. MySQL主从</a>
<ul class="sectlevel3">
<li><a href="#_主节点配置">15.6.1. 主节点配置</a></li>
<li><a href="#_从节点配置">15.6.2. 从节点配置</a></li>
</ul>
</li>
<li><a href="#_dockerfile">15.7. DockerFile</a></li>
<li><a href="#_docker网络">15.8. Docker网络</a></li>
<li><a href="#_compose">15.9. Compose</a>
<ul class="sectlevel3">
<li><a href="#_安装_7">15.9.1. 安装</a></li>
<li><a href="#_jenkins">15.9.2. Jenkins</a></li>
<li><a href="#_sonarqube">15.9.3. SonarQube</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_Maven_chapter">16. Maven</a>
<ul class="sectlevel2">
<li><a href="#_安装_8">16.1. 安装</a></li>
</ul>
</li>
<li><a href="#_Harbor_chapter">17. Harbor</a>
<ul class="sectlevel2">
<li><a href="#_安装_9">17.1. 安装</a></li>
<li><a href="#_使用">17.2. 使用</a></li>
</ul>
</li>
<li><a href="#_Ceph_chapter">18. Ceph</a>
<ul class="sectlevel2">
<li><a href="#_安装_10">18.1. 安装</a></li>
<li><a href="#_文件存储服务">18.2. 文件存储服务</a></li>
</ul>
</li>
<li><a href="#_Libvirt_chapter">19. Libvirt</a>
<ul class="sectlevel2">
<li><a href="#_安装配置_2">19.1. 安装配置</a>
<ul class="sectlevel3">
<li><a href="#_安装kvm环境">19.1.1. 安装kvm环境</a></li>
</ul>
</li>
<li><a href="#_安装虚拟机">19.2. 安装虚拟机</a>
<ul class="sectlevel3">
<li><a href="#_准备镜像文件">19.2.1. 准备镜像文件</a></li>
<li><a href="#_增加虚拟机">19.2.2. 增加虚拟机</a></li>
</ul>
</li>
<li><a href="#_常用命令_4">19.3. 常用命令</a>
<ul class="sectlevel3">
<li><a href="#_增加硬盘">19.3.1. 增加硬盘</a></li>
<li><a href="#_快照">19.3.2. 快照</a></li>
</ul>
</li>
<li><a href="#_镜像文件扩容">19.4. 镜像文件扩容</a></li>
</ul>
</li>
<li><a href="#_Btrfs_chapter">20. Btrfs</a>
<ul class="sectlevel2">
<li><a href="#_基本使用_2">20.1. 基本使用</a></li>
<li><a href="#_增量备份">20.2. 增量备份</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_前言">前言</h2>
<div class="sectionbody">
<div class="paragraph">
<p>思考杂记</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_Linux_chapter">1. Linux</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_系统服务">1.1. 系统服务</h3>
<div class="sect3">
<h4 id="_计划任务">1.1.1. 计划任务</h4>
<div class="ulist">
<ul>
<li>
<p>一次性计划任务</p>
<div class="ulist">
<ul>
<li>
<p>命令: <code>at 时间</code></p>
</li>
<li>
<p>查看计划任务 : <code>at -l</code></p>
</li>
<li>
<p>删除任务: <code>atrm 任务序号</code></p>
</li>
<li>
<p>非交互式创建计划任务: <code>echo "systemctl start httpd" | at 20:30</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>周期性计划任务</p>
<div class="ulist">
<ul>
<li>
<p>命令: <code>crontab -e</code></p>
</li>
<li>
<p>查看计划任务 : <code>crontab -l</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>计划任务格式为:</p>
</div>
<div class="paragraph">
<p>分 时 日 月 星期 命令</p>
</div>
<div class="paragraph">
<p>假设在每周一、三、五的凌晨3 点25 分，都需要使用tar 命令把某个网站的数据目录进行打包处理，使其作为一个备份文件</p>
</div>
<div class="paragraph">
<p>命令: <code>25 3 * * 1,3,5 /usr/bin/tar -zcvf backup.tar.gz /var/www</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TIP</dt>
<dd>
<p>在 <code>crond</code> 服务的计划任务参数中，所有命令一定要用绝对路径的方式来写，如果不知道绝对路径，请用 <code>whereis</code> 命令进行查询</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ssh">1.2. SSH</h3>
<div class="sect3">
<h4 id="_无密钥登陆">1.2.1. 无密钥登陆</h4>
<div class="listingblock">
<div class="title">生成密钥对</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ssh-keygen -N "" -f ~/.ssh/yss

# 生成带邮箱的密钥对
ssh-keygen -N "" -f ~/.ssh/yss -C xxxx@xxx.com</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">上传公钥文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ssh-copy-id -i $HOME/.ssh/yss.pub root@IP</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">配置SSH客户端私钥</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">touch ~/.ssh/config

chmod 755 ~/.ssh/config
cat &lt;&lt; EOF &gt;&gt; ~/.ssh/config
Host IP
    IdentityFile ~/.ssh/yss
EOF

chmod 400 ~/.ssh/config</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_时间同步">1.3. 时间同步</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#设置硬件时钟调整为与本地时钟一致
timedatectl set-local-rtc 1
#设置时区为上海
timedatectl set-timezone Asia/Shanghai

#安装ntpdate
yum -y install ntpdate
#同步时间
ntpdate -u  cn.ntp.org.cn
#同步完成后,date命令查看时间是否正确
date</code></pre>
</div>
</div>
<div class="paragraph">
<p>同步时间后可能部分服务器过一段时间又会出现偏差，因此最好设置crontab来定时同步时间，方法如下</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#安装crontab
yum -y install crontab
#创建crontab任务
crontab -e
#添加定时任务
*/20 * * * * /usr/sbin/ntpdate cn.ntp.org.cn &gt; /dev/null 2&gt;&amp;1
#重启crontab
service crond reload</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_proxychains">1.4. Proxychains</h3>
<div class="listingblock">
<div class="title">安装</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 获取源码
git clone https://github.com/rofl0r/proxychains-ng

# 编译和安装
cd proxychains-ng
./configure --prefix=/usr --sysconfdir=/etc
make &amp;&amp; make install &amp;&amp; make install-config

# 删除文件
cd .. &amp;&amp; rm -rf proxychains-ng</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Python_chapter">2. CentOS</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_python38">2.1. Python38</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 下载
wget https://www.python.org/ftp/python/3.8.1/Python-3.8.1.tgz
tar -zxvf Python-3.8.1.tgz

# 进入文件夹
cd Python-3.8.1

# 配置安装位置
./configure prefix=/usr/local/python3

# 安装
make &amp;&amp; make install

# 添加python3的软链接
ln -s /usr/local/python3/bin/python3.8 /usr/bin/python3

# 添加 pip3 的软链接
ln -s /usr/local/python3/bin/pip3.8 /usr/bin/pip3

# 设置pip源
pip3 install --upgrade -i https://pypi.tuna.tsinghua.edu.cn/simple pip
pip3 config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_php7">2.2. PHP7</h3>
<div class="listingblock">
<div class="title">增加SCL源</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum install -y centos-release-scl</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">安装PHP7.2</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum install -y rh-php72 \
    rh-php72-php  \
    rh-php72-php-bcmath \
    rh-php72-php-fpm \
    rh-php72-php-gd \
    rh-php72-php-intl \
    rh-php72-php-mbstring \
    rh-php72-php-mysqlnd \
    rh-php72-php-opcache \
    rh-php72-php-pdo \
    rh-php72-php-pecl-apcu \
    rh-php72-php-xmlrpc \
    rh-php72-php-devel</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">进入 <code>rh-php72</code> 环境</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">scl enable rh-php72 bash</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">备份php.ini</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cp /etc/opt/rh/rh-php72/php.ini /etc/opt/rh/rh-php72/php.ini.default</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">修改php.ini</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 启用 '&lt;? ... ?&gt;' 代码风格
sed -i '197s/short_open_tag = Off/short_open_tag = On/' /etc/opt/rh/rh-php72/php.ini

# 禁止一些危险性高的函数
sed -i '314s/disable_functions =/disable_functions = system,exec,shell_exec,passthru,set_time_limit,ini_alter,dl,openlog,syslog,readlink,symlink,link,leak,popen,escapeshellcmd,virtual,socket_create,mail,eval/' /etc/opt/rh/rh-php72/php.ini

# 配置中国时区
sed -i '902s#;date.timezone =#date.timezone = Asia/Shanghai#' /etc/opt/rh/rh-php72/php.ini</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">增加开机启动</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl enable rh-php72-php-fpm</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">启动 <code>PHP-FPM</code> 服务</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl start rh-php72-php-fpm</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">查看 <code>PHP-FPM</code> 服务状态</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># systemctl status rh-php72-php-fpm
● rh-php72-php-fpm.service - The PHP FastCGI Process Manager
   Loaded: loaded (/usr/lib/systemd/system/rh-php72-php-fpm.service; enabled; vendor preset: disabled)
   Active: active (running) since Fri 2019-11-29 13:36:03 CST; 1h 56min ago
 Main PID: 15360 (php-fpm)
   Status: "Processes active: 0, idle: 6, Requests: 56, slow: 0, Traffic: 0req/sec"
   CGroup: /system.slice/rh-php72-php-fpm.service
           ├─15360 php-fpm: master process (/etc/opt/rh/rh-php72/php-fpm.conf)
           ├─15361 php-fpm: pool www
           ├─15362 php-fpm: pool www
           ├─15363 php-fpm: pool www
           ├─15364 php-fpm: pool www
           ├─15365 php-fpm: pool www
           └─17211 php-fpm: pool www

Nov 29 13:36:03 iZ6weebcmroarpx8rrxscrZ systemd[1]: Starting The PHP FastCGI Process Manager...
Nov 29 13:36:03 iZ6weebcmroarpx8rrxscrZ systemd[1]: Started The PHP FastCGI Process Manager.

# ss -antpl|grep php-fpm
LISTEN     0      128    127.0.0.1:9000                     *:*                   users:(("php-fpm",pid=17211,fd=9),("php-fpm",pid=15365,fd=9),("php-fpm",pid=15364,fd=9),("php-fpm",pid=15363,fd=9),("php-fpm",pid=15362,fd=9),("php-fpm",pid=15361,fd=9),("php-fpm",pid=15360,fd=7))</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Nginx_chapter">3. Nginx</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_安装">3.1. 安装</h3>
<div class="listingblock">
<div class="title">增加 Nginx 官方源</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt; EOF &gt; /etc/yum.repos.d/nginx.repo
[nginx-stable]
name=nginx stable repo
baseurl=http://nginx.org/packages/centos/\$releasever/\$basearch/
gpgcheck=1
enabled=1
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true

[nginx-mainline]
name=nginx mainline repo
baseurl=http://nginx.org/packages/mainline/centos/\$releasever/\$basearch/
gpgcheck=1
enabled=0
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true
EOF</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>EPEL 源中的 <code>nginx.service</code> 由于 <code>KILL</code> 参数问题，启动后无法停止，不建议使用。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">安装Nginx</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum install -y nginx</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">备份Nginx配置文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">echo y|cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.default</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">修改 nginx.conf</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt; EOF &gt; /etc/nginx/nginx.conf
# For more information on configuration, see:
#   * Official English Documentation: http://nginx.org/en/docs/
#   * Official Russian Documentation: http://nginx.org/ru/docs/

user nginx;
worker_processes auto;
error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;

worker_rlimit_nofile 65535;

events {
    worker_connections 65535;
}

http {
    include             /etc/nginx/mime.types;
    default_type        application/octet-stream;

    log_format  main  escape=json '\$host \$server_port \$remote_addr - \$remote_user [\$time_local] "\$request" '
                      '\$status \$request_time \$body_bytes_sent "\$http_referer" '
                      '"\$http_user_agent" "\$http_x_forwarded_for"';


    access_log  /var/log/nginx/access.log  main;

    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    keepalive_timeout   65;
    types_hash_max_size 2048;

    server_names_hash_bucket_size 128;
    server_name_in_redirect off;
    client_header_buffer_size 32k;
    large_client_header_buffers 4 32k;

    client_header_timeout  3m;
    client_body_timeout    3m;
    client_max_body_size 50m;
    client_body_buffer_size 256k;
    send_timeout           3m;

    gzip  on;
    gzip_min_length  1k;
    gzip_buffers     4 16k;
    gzip_http_version 1.0;
    gzip_comp_level 2;
    gzip_types image/svg+xml application/x-font-wof text/plain text/xml text/css application/xml application/xhtml+xml application/rss+xml application/javascript application/x-javascript text/javascript;
    gzip_vary on;

    proxy_redirect off;
    proxy_set_header Host \$host;
    proxy_set_header X-Real-IP \$remote_addr;
    proxy_set_header REMOTE-HOST \$remote_addr;
    proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
    proxy_connect_timeout 60;
    proxy_send_timeout 60;
    proxy_read_timeout 60;
    proxy_buffer_size 256k;
    proxy_buffers 4 256k;
    proxy_busy_buffers_size 256k;
    proxy_temp_file_write_size 256k;
    proxy_next_upstream error timeout invalid_header http_500 http_503 http_404;
    proxy_max_temp_file_size 128m;
    #让代理服务端不要主动关闭客户端的连接，协助处理499返回代码问题
    proxy_ignore_client_abort on;

    fastcgi_buffer_size 64k;
    fastcgi_buffers 4 64k;
    fastcgi_busy_buffers_size 128k;

    index index.html index.htm index.php default.html default.htm default.php;

    # Load modular configuration files from the /etc/nginx/conf.d directory.
    # See http://nginx.org/en/docs/ngx_core_module.html#include
    # for more information.
    include /etc/nginx/conf.d/*.conf;
}
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">增加默认Host</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir /etc/nginx/conf.d

cat &lt;&lt; EOF &gt; /etc/nginx/conf.d/default.conf
server {
    listen       80 default_server;
    listen       [::]:80 default_server;
    server_name  _;
    root         /usr/share/nginx/html;

    # Load configuration files for the default server block.
    include /etc/nginx/default.d/*.conf;

    location / {
    }

    error_page 404 /404.html;
        location = /40x.html {
    }

    error_page 500 502 503 504 /50x.html;
        location = /50x.html {
    }
}
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">检测配置</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">nginx -t &amp;&amp; rm -f /var/run/nginx.pid</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>nginx -t</code> 之后，<code>/var/run/nginx.pid</code> 空文件会一直被保留，而 <code>nginx.service</code> 并不能处理 <code>PIDFile</code> 为空的情况，导致启动失败。</p>
</div>
<div class="paragraph">
<p>需要手动删除 <code>/var/run/nginx.pid</code></p>
</div>
<div class="paragraph">
<p>from nginx/1.16.1</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">启动Nginx</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl start nginx</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">查看Nginx状态</div>
<div class="content">
<pre># systemctl status nginx
● nginx.service - The nginx HTTP and reverse proxy server
   Loaded: loaded (/usr/lib/systemd/system/nginx.service; disabled; vendor preset: disabled)
   Active: active (running) since Fri 2019-11-29 14:02:31 CST; 1h 18min ago
 Main PID: 15759 (nginx)
   CGroup: /system.slice/nginx.service
           ├─15759 nginx: master process /usr/sbin/nginx
           └─17285 nginx: worker process

Nov 29 14:02:31 iZ6weebcmroarpx8rrxscrZ systemd[1]: Starting The nginx HTTP and reverse proxy server...
Nov 29 14:02:31 iZ6weebcmroarpx8rrxscrZ nginx[15753]: nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
Nov 29 14:02:31 iZ6weebcmroarpx8rrxscrZ nginx[15753]: nginx: configuration file /etc/nginx/nginx.conf test is successful
Nov 29 14:02:31 iZ6weebcmroarpx8rrxscrZ systemd[1]: Failed to parse PID from file /run/nginx.pid: Invalid argument
Nov 29 14:02:31 iZ6weebcmroarpx8rrxscrZ systemd[1]: Started The nginx HTTP and reverse proxy server.


# ss -antpl|grep nginx
LISTEN     0      128          *:80                       *:*                   users:(("nginx",pid=17285,fd=6),("nginx",pid=15759,fd=6))
LISTEN     0      128         :::80                      :::*                   users:(("nginx",pid=17285,fd=7),("nginx",pid=15759,fd=7))</pre>
</div>
</div>
<div class="listingblock">
<div class="title">增加开机启动</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl enable nginx</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_常用功能">3.2. 常用功能</h3>
<div class="sect3">
<h4 id="_反向代理">3.2.1. 反向代理</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">location / {
    proxy_pass http://10.0.2.30;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_负载均衡">3.2.2. 负载均衡</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">upstream nameserver {
    server 10.0.2.20:80;
    server 10.0.2.30:80;
}

server{
    location / {
    # 添加反向代理,代理地址填写upstream声明的名字
    proxy_pass http://nameserver;
    # 重写请求头部,保证网站所有页面都能访问成功
    proxy_set_header Host $host;
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
加权轮询 <code>server 10.0.2.20:80 weight=1</code>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Zabbix_chapter">4. Zabbix</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_安装_2">4.1. 安装</h3>
<div class="listingblock">
<div class="title">配置zabbix 5.0的源</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rpm -Uvh https://mirrors.aliyun.com/zabbix/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm

sed -i 's#http://repo.zabbix.com#https://mirrors.aliyun.com/zabbix#g' /etc/yum.repos.d/zabbix.repo

yum clean all
yum makecache</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">安装Zabbix-server</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum -y install zabbix-server-mysql zabbix-agent</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">安装SCL</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum -y install centos-release-scl</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">安装Zabbix前端环境</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sed -i '11s#0#1#' /etc/yum.repos.d/zabbix.repo

yum -y install zabbix-web-mysql-scl zabbix-apache-conf-scl</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">安装数据库</div>
<p>10.1</p>
</div>
<div class="listingblock">
<div class="title">创建数据库</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mysql -uroot -pgeek -e "create database zabbix character set utf8 collate utf8_bin;create user 'zabbix'@'localhost' identified by 'zabbix';grant all privileges on zabbix.* to 'zabbix'@'localhost';flush privileges;"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">导入zabbix初始数据</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">zcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz | mysql -uzabbix -pzabbix zabbix</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">修改zabbix配置文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#配置数据库密码
sed -i '124s# DBPassword=#DBPassword=zabbix#' /etc/zabbix/zabbix_server.conf
sed -i '124s/#DBPassword/DBPassword/' /etc/zabbix/zabbix_server.conf
#配置php时区
sed -i '25s#Europe/Riga#Asia/Shanghai#' /etc/opt/rh/rh-php72/php-fpm.d/zabbix.conf
sed -i '25s/; php/php/' /etc/opt/rh/rh-php72/php-fpm.d/zabbix.conf</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">启动zabbix服务</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl start zabbix-server zabbix-agent httpd rh-php72-php-fpm</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">设置开机自启</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl enable zabbix-server zabbix-agent httpd rh-php72-php-fpm</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">访问</div>
<p>访问: <code><a href="http://your_ip/zabbix" class="bare">http://your_ip/zabbix</a></code> 进行zabbix安装</p>
</div>
<div class="paragraph">
<p>数据库密码: <code>zabbix</code></p>
</div>
<div class="paragraph">
<p>账户: <code>Admin</code></p>
</div>
<div class="paragraph">
<p>密码: <code>zabbix</code></p>
</div>
<div class="paragraph">
<div class="title">处理乱码</div>
<p><code>Windows</code> :直接将windows字体文件上传至服务器的 <code>/usr/share/zabbix/assets/fonts</code> 文件夹下</p>
</div>
<div class="paragraph">
<p><code>Linux</code> : <code>scp /usr/share/fonts/WindowsFonts/方正粗黑宋简体.ttf root@192.168.43.57:/usr/share/zabbix/assets/fonts/graphfont.ttf</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_卸载">4.2. 卸载</h3>
<div class="listingblock">
<div class="title">完全卸载Zabbix</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 找到zabbix的安装包
rpm -qa|grep zabbix

# 卸载zabbix
yum -y remove 包名

# 删除文件目录
find / -name zabbix -exec rm {} +

# 删除zabbix数据库
mysql -uroot -pgeek -e 'drop database zabbix;'</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_添加主机">4.3. 添加主机</h3>
<div class="listingblock">
<div class="title">配置zabbix 5.0的源</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rpm -Uvh https://mirrors.aliyun.com/zabbix/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm

sed -i 's#http://repo.zabbix.com#https://mirrors.aliyun.com/zabbix#g' /etc/yum.repos.d/zabbix.repo

yum clean all
yum makecache</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">安装</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum -y install zabbix-agent</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">配置</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sed -i '117s/127.0.0.1/zabbix_server_ip/' /etc/zabbix/zabbix_agentd.conf</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">启动</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl start zabbix-agent</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">开机自启</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl enable zabbix-agent</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
zabbix网页配置:配置&#8212;&#8203;主机&#8212;&#8203;创建主机,模板---Liunx模板
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Jenkins_chapter">5. Jenkins</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_安装_3">5.1. 安装</h3>
<div class="paragraph">
<p><a href="https://get.jenkins.io/war-stable/">Jenkins War包</a></p>
</div>
<div class="paragraph">
<p>需要Java环境</p>
</div>
<div class="listingblock">
<div class="title">安装</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 先用代理启动，Jenkins初始化需要安装许多外网插件，插件安装完后去掉代理，正常启动
java -DsocksProxyHost=192.168.2.5 -DsocksProxyPort=1080 -jar jenkins.war</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">启动</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 后台启动
nohup java -jar jenkins.war &amp;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_插件">5.2. 插件</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">1. git parameter
2. publish over ssh</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_pipeline">5.3. PipeLine</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">// 所有脚本命令都放在pipeline
pipeline{
    // 指定任务构建在哪个集群执行
    agent any

    // 声明全局变量
    environment{
        Harbor_User = 'admin'
        Harbor_PassWord = 'Nuttertools123..'
        Harbor_Addr = '192.168.0.150:80'
        Harbor_Repo = 'repo'
    }


    stages {
        stage('拉取git仓库代码') {
            steps {
                checkout([$class: 'GitSCM', branches: [[name: '${tag}']], extensions: [], userRemoteConfigs: [[url: 'https://git.yssuvu.xyz:2035/root/mytest.git']]])
                echo '拉取git仓库代码 - SUCCESS'
            }
        }
        stage('通过maven构建代码') {
            steps {
                sh 'mvn clean package -DskipTests'
                echo '通过maven构建代码 - SUCCESS'
            }
        }
        stage('通过Docker指定自定义镜像') {
            steps {
                sh '''mv ./target/*.jar ./docker/
                docker build -t ${JOB_NAME}:${tag} ./docker/'''
                echo '通过Docker指定自定义镜像 - SUCCESS'
            }
        }
        stage('将自定义镜像推送到Harbor') {
            steps {
                sh '''docker login -u ${Harbor_User} -p ${Harbor_PassWord} ${Harbor_Addr}
                docker tag ${JOB_NAME}:${tag} ${Harbor_Addr}/${Harbor_Repo}/${JOB_NAME}:${tag}
                docker push ${Harbor_Addr}/${Harbor_Repo}/${JOB_NAME}:${tag}'''
                echo '将自定义镜像推送到Harbor - SUCCESS'
            }
        }
        stage('通过Publish Over SSH通知目标服务器') {
            steps {
                sshPublisher(publishers: [sshPublisherDesc(configName: 'test', transfers: [sshTransfer(cleanRemote: false, excludes: '', execCommand: "deploy.sh ${Harbor_Addr} ${Harbor_Repo} ${JOB_NAME} ${tag} ${port}", execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: '[, ]+', remoteDirectory: '', remoteDirectorySDF: false, removePrefix: '', sourceFiles: '')], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])
                echo '通过Publish Over SSH通知目标服务器 - SUCCESS'
            }
        }
    }
    post{
        success{
            dingtalk(
                robot: 'Jenkins-robot',
                type: 'MARKDOWN',
                title: "success:${JOB_NAME}",
                text:["- 成功构建:${JOB_NAME}\n- 版本:${tag} \n- 持续时间:${currentBuild.durationString}"]
            )
        }
        failure{
            dingtalk(
                robot: 'Jenkins-robot',
                type: 'MARKDOWN',
                title: "failure:${JOB_NAME}",
                text:["- 构建失败:${JOB_NAME}\n- 版本:${tag} \n- 持续时间:${currentBuild.durationString}"]
            )
        }
    }
}</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_RabbitMQ_chapter">6. RabbitMQ</h2>
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_Kafka_chapter">7. Kafka</h2>
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_Gitlab_chapter">8. Gitlab</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_安装_4">8.1. 安装</h3>
<div class="paragraph">
<p><strong>文档地址</strong></p>
</div>
<div class="paragraph">
<p><a href="https://docs.gitlab.com/ee/install/requirements.html">官方文档</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -s https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | bash

EXTERNAL_URL="http://192.168.43.65:8000"  yum install -y gitlab-ce</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
官方文档的下载地址速度比较慢,可以使用清华源下载: <a href="https://mirrors.tuna.tsinghua.edu.cn/help/gitlab-ce/">镜像地址</a>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">重新配置（恢复默认配置) 重启服务</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">gitlab-ctl reconfigure &amp;&amp; gitlab-ctl restart</code></pre>
</div>
</div>
<div class="paragraph">
<p>安装完毕后访问: http:/192.168.43.65:8000</p>
</div>
<div class="paragraph">
<p><code>cat /etc/gitlab/initial_root_password</code></p>
</div>
<div class="paragraph">
<p>默认登录用户 root，密码第一次访问会提示修改</p>
</div>
</div>
<div class="sect2">
<h3 id="_nginx反代gitlab">8.2. Nginx反代GitLab</h3>
<div class="paragraph">
<p>安装GitLab之后，通过单独的Nginx反代，暴露给外网访问。由于Nginx配置和GitLab内部的访问端口不同，为保证功能正常使用，需要修改GitLab配置</p>
</div>
<div class="sect3">
<h4 id="_gitlab设置">8.2.1. GitLab设置</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 禁用默认配置
sed -i 's/^external_url /#external_url /g' /etc/gitlab/gitlab.rb

cat &lt;&lt; EOF &gt;&gt; /etc/gitlab/gitlab.rb
# 设置gitlab对外暴露的地址
external_url 'https://git.xxx.com:2035'

# Git SSH Clone相关参数
gitlab_rails['gitlab_ssh_host'] = 'git.xxx.com'

# 禁用自动签发免费HTTPS证书
# letsencrypt['enable'] = false

# 禁用签发证书后，需要显式启用Nginx服务
nginx['enable'] = true
# 禁用Nginx的HTTPS配置
nginx['redirect_http_to_https'] = false
nginx['listen_https'] = false

# Nginx端口监听配置
nginx['listen_addresses'] = ['127.0.0.1']
nginx['listen_port'] = 8000

git_data_dirs({
    "default" =&gt; {
        "path" =&gt; "/data/gitlab_data"
    }
})
EOF

# 重新生成配置并重启
gitlab-ctl reconfigure &amp;&amp; gitlab-ctl restart

# 确认Nginx服务状态
ss -antpl|grep 8000</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_nginx_server配置">8.2.2. Nginx Server配置</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF&gt; /etc/nginx/conf.d/gitlab.conf
server {
    listen 2035 ssl http2;
    server_name git.xxx.com;

    # certs sent to the client in SERVER HELLO are concatenated in ssl_certificate
    ssl_certificate /etc/letsencrypt/live/xxx.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/xxx.com/privkey.pem;
    ssl_session_timeout 1d;
    ssl_session_cache shared:SSL:50m;
    ssl_session_tickets off;

    # Diffie-Hellman parameter for DHE ciphersuites, recommended 2048 bits
    ssl_dhparam /etc/letsencrypt/live/xxx.com/dhparam.pem;

    # intermediate configuration. tweak to your needs.
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers 'ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS';
    ssl_prefer_server_ciphers on;

    # HSTS (ngx_http_headers_module is required) (15768000 seconds = 6 months)
    add_header Strict-Transport-Security max-age=15768000;

    # OCSP Stapling ---
    # fetch OCSP records from URL in ssl_certificate and cache them
    ssl_stapling on;
    ssl_stapling_verify on;

    # 替换URL，解决README.md之类无法加载的问题
    sub_filter 'http://git.xxx.com'  'https://git.xxx.com';
    sub_filter_once off;
    sub_filter_last_modified on;
    # 替换 text/html application/json HTTP响应包中的内容
    sub_filter_types application/json;

    location / {
        auth_basic           "Administrator’s Area";
        auth_basic_user_file /etc/nginx/.htpasswd;

        # 必须设置，否则新建项目后，会302跳转到http的80端口
        proxy_set_header Host git.xxx.com:2035;
        proxy_set_header X-Real-IP \$remote_addr;
        proxy_set_header X-Forwarded-Proto https;

        proxy_pass http://127.0.0.1:8000;
    }

    location ~ ^/\.git/? {
        return 404;
    }
}
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">生效Nginx配置</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">nginx -t &amp;&amp; nginx -s reload</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_设置http_clone相关参数">8.2.3. 设置HTTP Clone相关参数</h4>
<div class="paragraph">
<p>用管理员帐号登录GitLab，进入以下菜单：</p>
</div>
<div class="paragraph">
<p><code>Admin Area</code> &gt; <code>Settings</code> &gt; <code>General</code> &gt; <code>Visibility and access controls</code></p>
</div>
<div class="paragraph">
<p>找到 <code>Custom Git clone URL for HTTP(S)</code>，根据实际情况填写，比如：<code><a href="https://git.xxx.com:2035" class="bare">https://git.xxx.com:2035</a></code></p>
</div>
</div>
<div class="sect3">
<h4 id="_最后">8.2.4. 最后</h4>
<div class="paragraph">
<p>外网GitLab访问地址
<a href="https://git.xxx.com" class="bare">https://git.xxx.com</a></p>
</div>
<div class="paragraph">
<p>SSH克隆地址
ssh://git@git.xxx.com/用户名/项目名称.git</p>
</div>
<div class="paragraph">
<p>HTTP克隆地址
<a href="https://git.xxx.com:2035/用户名/项目名称.git" class="bare">https://git.xxx.com:2035/用户名/项目名称.git</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_gitlab邮件服务">8.3. GitLab邮件服务</h3>
<div class="listingblock">
<div class="title">配置</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt; EOF &gt;&gt; /etc/gitlab/gitlab.rb
gitlab_rails['smtp_enable'] = true
gitlab_rails['smtp_address'] = "smtp.qq.com"
gitlab_rails['smtp_port'] = 465
gitlab_rails['smtp_user_name'] = "邮箱@qq.com"
gitlab_rails['smtp_password'] = "开通smtp时返回的授权码"
gitlab_rails['smtp_domain'] = "qq.com"
gitlab_rails['smtp_authentication'] = "login"
gitlab_rails['smtp_enable_starttls_auto'] = true
gitlab_rails['smtp_tls'] = true

user['git_user_email'] = "邮箱@qq.com"
gitlab_rails['gitlab_email_from'] = '邮箱@qq.com'
EOF

# 重新生成配置并重启
gitlab-ctl reconfigure &amp;&amp; gitlab-ctl restart</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">测试</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">执行命令gitlab-rails console测试发邮件，进入控制台之后执行命令:

Notify.test_email('xx@qq.com', 'title', 'content').deliver_now</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_常用命令">8.4. 常用命令</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 启动
gitlab-ctl start

# 重启
gitlab-ctl restart

# 停止
gitlab-ctl start

# 查看所有的logs; 按 Ctrl-C 退出
gitlab-ctl tail

# 拉取/var/log/gitlab下子目录的日志
gitlab-ctl tail gitlab-rails

# 拉取某个指定的日志文件
gitlab-ctl tail nginx/gitlab_error.log

# 更新配置文件
gitlab-ctl reconfigure

# 检查gitlab配置
gitlab-rake gitlab:check SANITIZE=true --trace

# 查看版本
cat /opt/gitlab/embedded/service/gitlab-rails/VERSION</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Git_chapter">9. Git</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_系统设置">9.1. 系统设置</h3>
<div class="listingblock bash">
<div class="title">设置默认编辑器</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">git config --global core.editor vim</code></pre>
</div>
</div>
<div class="listingblock bash">
<div class="title">设置系统用户</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">git config --global user.name "xxx"</code></pre>
</div>
</div>
<div class="listingblock bash">
<div class="title">设置系统用户邮箱</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">git config --global user.email "xxx"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_基本命令">9.2. 基本命令</h3>
<div class="sect3">
<h4 id="_文件操作">9.2.1. 文件操作</h4>
<div class="listingblock bash">
<div class="title">从暂存区内删除文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">git rm --cache 文件名</code></pre>
</div>
</div>
<div class="listingblock bash">
<div class="title">取消暂存区内的文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">git restore --staged 文件名</code></pre>
</div>
</div>
<div class="listingblock bash">
<div class="title">添加远程仓库</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">git remote add &lt;shortname&gt; &lt;url&gt;</code></pre>
</div>
</div>
<div class="listingblock bash">
<div class="title">创建标签</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">git tag -a 标签版本 -m "附注信息"</code></pre>
</div>
</div>
<div class="listingblock bash">
<div class="title">推送标签至远程仓库</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"># 推送指定标签
git push origin v1.5
# 推送全部标签
git push origin --tags</code></pre>
</div>
</div>
<div class="listingblock bash">
<div class="title">删除远程仓库的标签</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">git push origin --delete &lt;tagname&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">只删除远程仓库文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 删除你要删除的文件名称，这里是删除target文件夹（cached不会把本地的flashview文件夹删除）
git rm -r --cached target</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_分支管理">9.2.2. 分支管理</h4>
<div class="listingblock bash">
<div class="title">创建分支</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">git branch 分支名</code></pre>
</div>
</div>
<div class="listingblock bash">
<div class="title">切换分支</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">git checkout 分支名</code></pre>
</div>
</div>
<div class="listingblock bash">
<div class="title">创建分支同时切换过去</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">git checkout -b &lt;newbranchname&gt;

git switch -c &lt;newbranchname&gt;</code></pre>
</div>
</div>
<div class="listingblock bash">
<div class="title">查看已经合并分支</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">git branch --merge</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_MySQL_chapter">10. MySQL</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_安装_5">10.1. 安装</h3>
<div class="listingblock">
<div class="title">安装 MySQL</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum install -y mariadb-server</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">备份 <code>my.cnf</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cp /etc/my.cnf /etc/my.cnf.default</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">修改 <code>my.cnf</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt; EOF &gt; /etc/my.cnf
[client]
default_character_set = utf8
[mysqld]
datadir=/var/lib/mysql
socket=/var/lib/mysql/mysql.sock
collation_server = utf8_general_ci
character_set_server = utf8
# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links=0
# Settings user and group are ignored when systemd is used.
# If you need to run mysqld under a different user or group,
# customize your systemd unit file for mariadb according to the
# instructions in http://fedoraproject.org/wiki/Systemd
max_allowed_packet=20M
max_heap_table_size = 100M
read_buffer_size = 2M
read_rnd_buffer_size = 16M
sort_buffer_size = 8M
join_buffer_size = 8M
tmp_table_size = 100M
# 查询缓存
#query_cache_limit=4M
#query_cache_type=on
#query_cache_size=2G
#bind-address = 127.0.0.1
# 跳过主机名解析，比如localhost，foo.com之类，加速访问
skip-name-resolve
# SQL执行日志
general_log=off
general_log_file=/var/log/mariadb/general.log
# SQL慢查询日志
slow_query_log=off
slow_query_log_file=/var/log/mariadb/slowquery.log
long_query_time = 5
max_connections = 1000
# 兼容老MySQL代码，比如使用空字符串代替NULL插入数据
sql_mode = ""
[mysqld_safe]
log-error=/var/log/mariadb/mariadb.log
pid-file=/var/run/mariadb/mariadb.pid
#
# include all files from the config directory
#
!includedir /etc/my.cnf.d
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">配置 <code>mysqldump</code> 命令参数</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sed -i '16 aquick\nquote-names\nmax_allowed_packet = 100M' /etc/my.cnf.d/mysql-clients.cnf</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">创建日志文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">touch /var/log/mariadb/general.log /var/log/mariadb/slowquery.log
chown mysql:mysql /var/log/mariadb/general.log /var/log/mariadb/slowquery.log</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">增加开机启动</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl enable mariadb</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">启动 <code>MySQL</code> 服务</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl start mariadb</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">查看 <code>MySQL</code> 服务状态</div>
<div class="content">
<pre># systemctl status mariadb
● mariadb.service - MariaDB database server
   Loaded: loaded (/usr/lib/systemd/system/mariadb.service; enabled; vendor preset: disabled)
   Active: active (running) since Fri 2019-11-29 14:18:12 CST; 1h 7min ago
  Process: 16688 ExecStartPost=/usr/libexec/mariadb-wait-ready $MAINPID (code=exited, status=0/SUCCESS)
  Process: 16653 ExecStartPre=/usr/libexec/mariadb-prepare-db-dir %n (code=exited, status=0/SUCCESS)
 Main PID: 16687 (mysqld_safe)
   CGroup: /system.slice/mariadb.service
           ├─16687 /bin/sh /usr/bin/mysqld_safe --basedir=/usr
           └─17043 /usr/libexec/mysqld --basedir=/usr --datadir=/var/lib/mysql --plugin-dir=/usr/lib64/mysql/plugin --log-error=/var/log/mariadb/mariadb.lo...
Nov 29 14:18:10 iZ6weebcmroarpx8rrxscrZ systemd[1]: Starting MariaDB database server...
Nov 29 14:18:10 iZ6weebcmroarpx8rrxscrZ mariadb-prepare-db-dir[16653]: Database MariaDB is probably initialized in /var/lib/mysql already, nothing is done.
Nov 29 14:18:11 iZ6weebcmroarpx8rrxscrZ mysqld_safe[16687]: 191129 14:18:11 mysqld_safe Logging to '/var/log/mariadb/mariadb.log'.
Nov 29 14:18:11 iZ6weebcmroarpx8rrxscrZ mysqld_safe[16687]: 191129 14:18:11 mysqld_safe Starting mysqld daemon with databases from /var/lib/mysql
Nov 29 14:18:12 iZ6weebcmroarpx8rrxscrZ systemd[1]: Started MariaDB database server.
# ss -antpl|grep mysql
LISTEN     0      50     127.0.0.1:3306                     *:*                   users:(("mysqld",pid=17043,fd=14))</pre>
</div>
</div>
<div class="listingblock">
<div class="title">修改root密码</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mysqladmin -uroot password "geek"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">删除测试数据库和空密码用户</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mysql -uroot -pgeek -e 'show databases;'
mysql -uroot -pgeek -e 'drop database test;'
mysql -uroot -pgeek mysql -e 'delete from db;'
mysql -uroot -pgeek mysql -e 'delete from user where Password="";'
mysql -uroot -pgeek -e 'flush privileges;'</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_常用命令_2">10.2. 常用命令</h3>
<div class="sect3">
<h4 id="_创建用户开放指定host登录">10.2.1. 创建用户、开放指定HOST登录</h4>
<div class="listingblock">
<div class="title">创建用户</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 创建任意host可登陆账户
CREATE USER yss@'%' IDENTIFIED BY '123456' ;

# 创建指定host可登陆账户
CREATE USER yss@'10.0.0.2/%' IDENTIFIED BY '123456' ;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">修改密码</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 用户为自己更改密码
SET PASSWORD=PASSWORD('456789');

# Root用户为其他用户改密码
SET PASSWORD FOR yss@'%'=PASSWORD('456789');</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_用户授权">10.2.2. 用户授权</h4>
<div class="listingblock">
<div class="title">查看当前系统有哪些用户</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">SELECT user FROM mysql.user;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">查看指定用户的权限</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">SHOW GRANTS FOR user_name@'%';</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">用户授权</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 给已存在用户授权
GRANT ALL ON db_name.table_name TO yss@'%';

# 创建用户并授权
GRANT ALL ON db_name.table_name TO yss@'%' IDENTIFIED BY '123456';</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">取消用户授权</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">REVOKE [SELECT,DELETE,UPDATE,DROP...] ON db_name.table_name FROM yss@'%';</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_备份与还原">10.2.3. 备份与还原</h4>
<div class="listingblock">
<div class="title">备份</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mysqldump -uusername -p'password' --add-drop-table db_name &gt; db_name_dump.sql</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">还原</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mysql -uusername -p'password' db_name &lt; db_name_dump.sql</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>备份多个库: --databases 库1,库2</p>
</li>
<li>
<p>备份所有库: --all-databases</p>
</li>
<li>
<p>备份多个表: 库名 表1 表2</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_创建数据库时指定字符集">10.2.4. 创建数据库时指定字符集</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">CREATE DATABASE db_name DEFAULT CHARACTER SET utf8mb4 DEFAULT COLLATE utf8mb4_unicode_ci;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_字符集">10.2.5. 字符集</h4>
<div class="listingblock">
<div class="title">查看本机字符集</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">show variables like 'character%';</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mysql集群">10.3. MySQL集群</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">主节点</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10.0.2.20</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">从节点</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10.0.2.30</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_主从备份">10.3.1. 主从备份</h4>
<div class="paragraph">
<p><strong>主节点配置</strong></p>
</div>
<div class="listingblock">
<div class="title">修改 <code>my.cnf</code> 文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vim /etc/my.cnf
[mysqld]
#记录操作日志
log-bin=mysql-bin
#不同步mysql系统数据库
binlog-ignore-db = mysql
#数据库集群的节点id
server-id=20</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">修改系统配置</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 重启数据库服务，使配置文件生效
systemctl restart mariadb
# 在主节点创建一个slave用户连接节点mysql2，并赋予从节点同步主节点数据库权限
mysql -uroot -pgeek -e 'grant replication slave on *.* to slave@"10.0.2.30" identified by "geek";flush privileges;'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>从节点配置</strong></p>
</div>
<div class="listingblock">
<div class="title">修改 <code>my.cnf</code> 文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vim /etc/my.cnf
[mysqld]
log-bin=mysql-bin
replicate-ignore-db=mysql
server-id=30</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">修改系统配置</div>
<p>在主节点使用 <code>show master stauts;</code> 查询</p>
</div>
<div class="paragraph">
<p><code>master_log_file</code> 和 <code>master_log_pos</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl restart mariadb

mysql -uroot -pgeek -e 'change master to master_host="10.0.2.20",master_user="slave",master_password="geek",master_log_file="xxxx",master_log_pos=xxxx;start slave;flush privileges;'</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">验证从节点服务是否开启</div>
<p>在从节点服务器执行命令: <code>mysql -uroot -pgeek -e 'show slave status\G'`</code>,如果 <code>Slave_IO_Running</code> 和 <code>Slave_SQL_Running</code> 的状态都为YES，则节点服务开启成功</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@ylighgh ~]# mysql -uroot -pgeek -e'show slave status\G'
*************************** 1. row ***************************
            ...
             Slave_IO_Running: Yes
            Slave_SQL_Running: Yes
            ...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_主主备份">10.3.2. 主主备份</h4>
<div class="paragraph">
<p><strong>主节点配置</strong></p>
</div>
<div class="listingblock">
<div class="title">修改 <code>my.cnf</code> 文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vim /etc/my.cnf
[mysqld]
log-bin=mysql-bin
binlog-ignore-db=mysql
binlog-ignore-db=information_scheme
server-id=20</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">修改系统配置</div>
<p>使用 <code>show master stauts;</code> 查询信息</p>
</div>
<div class="paragraph">
<p>修改 <code>master_log_file</code> 和 <code>master_log_pos</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl restart mariadb
mysql -uroot -pgeek -e 'grant replication slave on *.* to slave@"10.0.2.30" identified by "geek";flush privileges;'

mysql -uroot -pgeek -e 'change master to master_host="10.0.2.30",master_user="slave",master_password="geek",master_log_file="xxxx",master_log_pos=xxxx;start slave;flush privileges;'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>从节点配置</strong></p>
</div>
<div class="listingblock">
<div class="title">修改 <code>my.cnf</code> 文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vim /etc/my.cnf
[mysqld]
log-bin=mysql-bin
binlog-ignore-db=mysql
binlog-ignore-db=information_scheme
server-id=30</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">修改系统配置</div>
<p>使用 <code>show master stauts;</code> 查询信息</p>
</div>
<div class="paragraph">
<p>修改 <code>master_log_file</code> 和 <code>master_log_pos</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl restart mariadb
mysql -uroot -pgeek -e 'grant replication slave on *.* to slave@"10.0.2.20" identified by "geek";flush privileges;'


mysql -uroot -pgeek -e 'change master to master_host="10.0.2.20",master_user="slave",master_password="geek",master_log_file="xxxx",master_log_pos=xxxx;start slave;flush privileges;'</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">验证主从节点服务是否开启</div>
<p>在主从节点服务器执行命令: <code>mysql -uroot -pgeek -e 'show slave status\G'`</code>,如果 <code>Slave_IO_Running</code> 和 <code>Slave_SQL_Running</code> 的状态都为YES，则节点服务开启成功</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@ylighgh ~]# mysql -uroot -pgeek -e'show slave status\G'
*************************** 1. row ***************************
            ...
             Slave_IO_Running: Yes
            Slave_SQL_Running: Yes
            ...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_多主一从">10.3.3. 多主一从</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">主节点1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10.0.2.20</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">主节点2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10.0.2.30</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">从节点</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10.0.2.40</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>主节点1配置</strong></p>
</div>
<div class="listingblock">
<div class="title">修改 <code>my.cnf</code> 文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vim /etc/my.cnf
[mysqld]
log-bin=mysql-bin
binlog-ignore-db=mysql
binlog-ignore-db=information_scheme
server-id=20</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">重启MySQL</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl restart mariadb</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">修改系统配置</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mysql -uroot -pgeek -e 'grant replication slave on *.* to slave@"10.0.2.40" identified by "geek";flush privileges;'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>主节点2配置</strong></p>
</div>
<div class="listingblock">
<div class="title">修改 <code>my.cnf</code> 文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vim /etc/my.cnf
[mysqld]
log-bin=mysql-bin
binlog-ignore-db=mysql
binlog-ignore-db=information_scheme
server-id=30</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">重启MySQL</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl restart mariadb</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">修改系统配置</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mysql -uroot -pgeek -e 'grant replication slave on *.* to slave@"10.0.2.40" identified by "geek";flush privileges;'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>从节点配置</strong></p>
</div>
<div class="listingblock">
<div class="title">修改 <code>my.cnf</code> 文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vim /etc/my.cnf
[mysqld_multi]
mysqld=/usr/bin/mysqld_safe
mysqladmin=/usr/bin/mysqladmin
log=/tmp/multi.log

[mysqld20]
port=3307
datadir=/var/lib/mysqla/
pid-file=/var/lib/mysqla/mysqld.pid
socket=/var/lib/mysqla/mysql.sock
user=mysql
server-id=40

[mysqld30]
port=3308
datadir=/var/lib/mysqlb/
pid-file=/var/lib/mysqlb/mysqld.pid
socket=/var/lib/mysqlb/mysql.sock
user=mysql
server-id=40</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">初始化数据库,生成目录</div>
<p><code>mysqla</code> <code>mysqlb</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mysql_install_db --datadir=/var/lib/mysqla --user=mysql
mysql_install_db --datadir=/var/lib/mysqlb --user=mysql

chown -R mysql:mysql /var/lib/mysqla
chown -R mysql:mysql /var/lib/mysqlb</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">启动MySQL</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mysqld_multi --defaults-file=/etc/my.cnf start 20
mysqld_multi --defaults-file=/etc/my.cnf start 30</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">查看状态</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@slave2-2022 ~]# ss -antpl|grep mysql
LISTEN     0      50           *:3307                     *:*                   users:(("mysqld",pid=6964,fd=14))
LISTEN     0      50           *:3308                     *:*                   users:(("mysqld",pid=7925,fd=14))</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">修改从节点配置</div>
<p><strong>3308</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mysql -uroot -P 3307 -S /var/lib/mysqla/mysql.sock

change master to master_user='slave',master_password='geek',master_host='10.0.2.20',master_log_file='mysql-bin.000014',master_log_pos=1312;start slave;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>3307</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mysql -uroot -P 3308 -S /var/lib/mysqlb/mysql.sock

change master to master_user='slave',master_password='geek',master_host='10.0.2.30',master_log_file='mysql-bin.000011',master_log_pos=629;start slave;</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Redis_chapter">11. Redis</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_安装配置">11.1. 安装配置</h3>
<div class="listingblock">
<div class="title">安装</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum -y install redis</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">启动</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl start redis</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">设置开机自启</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl enable redis</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">查看redis状态</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@master-2022 system]# systemctl status redis
● redis.service - Redis persistent key-value database
   Loaded: loaded (/usr/lib/systemd/system/redis.service; disabled; vendor preset: disabled)
  Drop-In: /etc/systemd/system/redis.service.d
           └─limit.conf
   Active: active (running) since Mon 2022-05-30 05:31:28 CST; 1s ago
  Process: 22952 ExecStop=/usr/libexec/redis-shutdown (code=exited, status=0/SUCCESS)
 Main PID: 22982 (redis-server)
   CGroup: /system.slice/redis.service
           └─22982 /usr/bin/redis-server 127.0.0.1:6379

May 30 05:31:28 master-2022 systemd[1]: Starting Redis persistent key-val....
May 30 05:31:28 master-2022 systemd[1]: Started Redis persistent key-valu....
Hint: Some lines were ellipsized, use -l to show in full.
[root@master-2022 system]# ss -antpl|grep redis
LISTEN     0      128    127.0.0.1:6379                     *:*                   users:(("redis-server",pid=22982,fd=4))</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_常用命令_3">11.2. 常用命令</h3>
<div class="sect3">
<h4 id="_键key">11.2.1. 键(Key)</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 设置key值
set name yss

# 获取key对应的value值
get name

# 删除一个已经创建的key
del name

# 设置key值,如果已经存在则返回0
setnx name yss

# 判断key是否存在,存在返回1,不存在返回0
exists name

# 为给定 key 设置过期时间，以秒计
expire name

# 查找所有符合给定模式( pattern)的 key
keys rts*

# 删除一个或多个键
del area_info_a area_info_b

# 删除模糊匹配的键
redis-cli --scan --pattern users:* | xargs redis-cli unlink</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_字符串string">11.2.2. 字符串(String)</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 同时设置一个或多个 key-value 对
mset key1 value1 [key2 value2]

# 获取所有(一个或多个)给定 key 的值
mget key1 [key2]

# 将 key 中储存的数字值增一
incr key
# 将 key 中储存的数字值减一
decr key

# 将 key 所储存的值加上给定的增量值（increment）
incrby key increment
# key 所储存的值减去给定的减量值（decrement）
decrby key decrement</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_哈希表hash">11.2.3. 哈希表(Hash)</h4>
<div class="listingblock">
<div class="title">增加字段或设置字段</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 向哈希表中增加字段或设置字段值
hset area_info name "四川"

# 向哈希表中增加多个字段或设置多个字段值
hmset area_info name "四川" level 2</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">获取字段</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 获取哈希表中指定键的单个字段和值
hget area_info name

# 获取所有给定字段的值
hmget area_info name level

# 获取哈希表中指定键的所有字段和值
hgetall area_info</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">字段是否存在</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 查看哈希表的指定字段是否存在
hexists area_info name</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">删除字段</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 删除一个或多个哈希表字段
hdel area_info name level</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_列表list">11.2.4. 列表(List)</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 将一个或多个值插入到列表头部
lpush key_list value1 value2
lpush key_list value3

# 获取列表长度
llen key_list


LRANGE runoobkey 0 10

# 移出并获取列表的第一个元素
lpop key_list</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_集合set">11.2.5. 集合(Set)</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 添加一个或多个元素到集合中
sadd key member [members...]

# 获取集合里面所有的元素
smembers key

# 从指定集合中删除指定元素
srem key member [members]

# 从指定集合中删除随意删除一个元素并返回
spop key

# 统计集合中元素的个数
scard key

# 返回指定的差集
sdiff key [key...]

# 返回指定集合的交集
sinter key [key...]

# 获取指定集合的并集
sunion key [key...]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_高级应用">11.3. 高级应用</h3>
<div class="sect3">
<h4 id="_密码防护">11.3.1. 密码防护</h4>
<div class="listingblock">
<div class="title">修改密码</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sed -i '480s/#//' /etc/redis.conf
sed -i '480s/foobared/geek/' /etc/redis.conf

# 修改密码之后重启redis
systemctl restart redis

# 登陆
redis-cil -a PASSWORD --row
或
auth PASSWORD</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_主从备份_2">11.3.2. 主从备份</h4>
<div class="paragraph">
<p><strong>主服务器设置</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sed -i '61s/^/# /' /etc/redis.conf

systemctl restart redis</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>从服务器设置</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sed -i '265aslaveof 10.0.2.20 6379' /etc/redis.conf

sed -i '273amasterauth geek' /etc/redis.conf

systemctl restart redis</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Rsync_chapter">12. Rsync</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_数据传输">12.1. 数据传输</h3>
<div class="listingblock">
<div class="title">下行同步(下载)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rsync -avz 服务器地址:/服务器目录/* /本地目录</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">上行同步(上传)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rsync -avz /本地目录/* 服务器地址:/服务器目录/</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">参数解释</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">-a: 归档模式,递归保留对象属性
-v: 显示同步过程
-z: 在传输时进行压缩</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">创建数据同步用户</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">useradd test
echo "testupload" | passwd test --stdin

# 设置acl权限
setfacl -m u:test:rwx /filesrc</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_实时同步">12.2. 实时同步</h3>
<div class="paragraph">
<p>rsync+inotify</p>
</div>
<div class="listingblock">
<div class="title">inotify安装</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">wget  http://github.com/downloads/rvoicilas/inotify-tools/inotify-tools-3.14.tar.gz

tar -xf inotify-tools-3.14.tar.gz

cd inotify-tools-3.14

yum -y install gcc*

./configure &amp;&amp; make &amp;&amp; make install</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">同步脚本</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cat &lt;&lt;EOF&gt; rsync.sh
#!/bin/bash
a="inotifywait -mrq -e create,delete,modify /filesrc"
b="rsync -avz /filesrc/* root@192.168.88.20:/filedest"
\$a | while read directory event file
do
    \$b
done
EOF

chmod +x rsync.sh</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_客户端服务器模式">12.3. 客户端服务器模式</h3>
<div class="listingblock">
<div class="title">客户端</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF&gt; /etc/rsync.conf
port = 52050
pid file = /var/log/rsync/rsyncd.pid
lock file = /var/log/rsync/rsync.lock
log file = /var/log/rsync/rsyncd.log
use chroot = false
strict modes = false
hosts allow = 127.0.0.1,192.168.122.225
ignore errors = true
read only = true
list = yes
max connections = 10
auth users = whoareyou
secrets file = /var/log/rsync/rsyncd.pass
uid = root
gid = root

[delete]
path = /tmp/.snapshots/create_and_delete-snap/
EOF

cat &lt;&lt;EOF&gt; /var/log/rsync/rsyncd.pass
whoareyou:123456
EOF

# 开启
rsync --daemon

# 验证
suse:~ # ss -antpl|grep 52050
LISTEN 0      5            0.0.0.0:52050      0.0.0.0:*    users:(("rsync",pid=14431,fd=5))
LISTEN 0      5               [::]:52050         [::]:*    users:(("rsync",pid=14431,fd=6))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">客户端</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF&gt; ~/workspace/shell/rsync.sh
#! /bin/bash
echo &gt;&gt; /var/log/rsync.log
echo 同步开始于  `date +%F%t%T` &gt;&gt; /var/log/rsync.log

log_file=/var/log/rsync_download.log
time=`date +%F%t%T`

cmd="rsync -abvcz --port=52050 --progress --delete --backup-dir=/www/master_bak/conf/change/`date +%Y%m%d` --password-file=/var/log/rsync/rsync.pass --log-file=${log_file} whoareyou@rsync_server::delete /www/master_bak/conf/source/"
echo ${time} $cmd&gt;&gt;/var/log/rsync.log  2&gt;&amp;1
$cmd


echo 同步结束于  `date +%F%t%T`&gt;&gt;/var/log/rsync.log

echo &gt;&gt; /var/log/rsync.log
echo &gt;&gt; /var/log/rsync.log
echo &gt;&gt; /var/log/rsync.log
echo &gt;&gt; /var/log/rsync.log
EOF

cat &lt;&lt;EOF&gt; /var/log/rsync/rsync.pass
123456
EOF</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Java_chapter">13. Java</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_java_web">13.1. Java_web</h3>
<div class="sect3">
<h4 id="_jdk">13.1.1. JDK</h4>
<div class="sect4">
<h5 id="_源码包安装">源码包安装</h5>
<div class="paragraph">
<p><a href="https://www.oracle.com/java/technologies/downloads/#java11">Java11下载地址</a></p>
</div>
<div class="listingblock">
<div class="title">创建目录</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir /usr/java</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">解压文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">tar -xf jdk-11.0.15.1_linux-x64_bin.tar.gz -C /usr/java</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">设置环境变量</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF&gt;&gt; /etc/profile
# set java environment
export JAVA_HOME=/usr/java/jdk-11.0.15.1
export CLASSPATH=\$JAVA_HOME/lib/tools.jar:\$JAVA_HOME/lib/dt.jar:\$JAVA_HOME/lib
export PATH=\$JAVA_HOME/bin:\$PATH
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">加载环境变量</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">source /etc/profile</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">查看Java版本号</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[yss@master-2022 workspace]# java -version
java version "11.0.15.1" 2022-04-22 LTS
Java(TM) SE Runtime Environment 18.9 (build 11.0.15.1+2-LTS-10)
Java HotSpot(TM) 64-Bit Server VM 18.9 (build 11.0.15.1+2-LTS-10, mixed mode)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tomcat">13.1.2. Tomcat</h4>
<div class="sect4">
<h5 id="_源码包安装_2">源码包安装</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">wget https://mirrors.aliyun.com/apache/tomcat/tomcat-8/v8.5.78/bin/apache-tomcat-8.5.78.tar.gz</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">解压文件夹</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">tar -xf apache-tomcat-8.5.78.tar.gz</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">重命名Tomcat目录</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mv apache-tomcat-8.5.78 /usr/local/tomcat/</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">设置文件的所属用户</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">useradd www
chown -R www.www /usr/local/tomcat/</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>/usr/local/tomcat/</code> 目录目录说明</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">bin：存放Tomcat的一些脚本文件，包含启动和关闭Tomcat服务脚本。
conf：存放Tomcat服务器的各种全局配置文件，其中最重要的是server.xml和web.xml。
webapps：Tomcat的主要Web发布目录，默认情况下把Web应用文件放于此目录。
logs：存放Tomcat执行时的日志文件。</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">备份默认文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mv /usr/local/tomcat/conf/server.xml /usr/local/tomcat/conf/server.xml_bak</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">修改配置文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF&gt; /usr/local/tomcat/conf/server.xml
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Server port="8006" shutdown="SHUTDOWN"&gt;
&lt;Listener className="org.apache.catalina.core.JreMemoryLeakPreventionListener"/&gt;
&lt;Listener className="org.apache.catalina.mbeans.GlobalResourcesLifecycleListener"/&gt;
&lt;Listener className="org.apache.catalina.core.ThreadLocalLeakPreventionListener"/&gt;
&lt;Listener className="org.apache.catalina.core.AprLifecycleListener"/&gt;
&lt;GlobalNamingResources&gt;
&lt;Resource name="UserDatabase" auth="Container"
 type="org.apache.catalina.UserDatabase"
 description="User database that can be updated and saved"
 factory="org.apache.catalina.users.MemoryUserDatabaseFactory"
 pathname="conf/tomcat-users.xml"/&gt;
&lt;/GlobalNamingResources&gt;
&lt;Service name="Catalina"&gt;
&lt;Connector port="8080"
 protocol="HTTP/1.1"
 connectionTimeout="20000"
 redirectPort="8443"
 maxThreads="1000"
 minSpareThreads="20"
 acceptCount="1000"
 maxHttpHeaderSize="65536"
 debug="0"
 disableUploadTimeout="true"
 useBodyEncodingForURI="true"
 enableLookups="false"
 URIEncoding="UTF-8"/&gt;
&lt;Engine name="Catalina" defaultHost="localhost"&gt;
&lt;Realm className="org.apache.catalina.realm.LockOutRealm"&gt;
&lt;Realm className="org.apache.catalina.realm.UserDatabaseRealm"
  resourceName="UserDatabase"/&gt;
&lt;/Realm&gt;
&lt;Host name="localhost" appBase="/data/wwwroot/default" unpackWARs="true" autoDeploy="true"&gt;
&lt;Context path="" docBase="/data/wwwroot/default" debug="0" reloadable="false" crossContext="true"/&gt;
&lt;Valve className="org.apache.catalina.valves.AccessLogValve" directory="logs"
prefix="localhost_access_log." suffix=".txt" pattern="%h %l %u %t &amp;quot;%r&amp;quot; %s %b" /&gt;
&lt;/Host&gt;
&lt;/Engine&gt;
&lt;/Service&gt;
&lt;/Server&gt;
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">设置JVM内存参数</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF&gt; /usr/local/tomcat/bin/setenv.sh
JAVA_OPTS='-Djava.security.egd=file:/dev/./urandom -server -Xms256m -Xmx496m -Dfile.encoding=UTF-8'
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">增加系统服务进程</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF &gt; /lib/systemd/system/tomcat.service
[Unit]
Description=Tomcat
After=syslog.target

[Service]
Type=forking
ExecStart=/usr/local/tomcat/bin/catalina.sh start
ExecReload=/bin/kill -s HUP $MAINPID
ExecStop=/bin/kill -s QUIT $MAINPID
PrivateTmp=true
User=root
SuccessExitStatus=143

[Install]
WantedBy=multi-user.target
EOF

systemctl daemon-reload</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">启动tomcat服务</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl start tomcat</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">设置开启自启</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl enable tomcat</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">查看tomcat状态</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@master-2022 bin]# ss -antpl|grep 8080
LISTEN     0      128          *:8080                     *:*                   users:(("java",pid=10900,fd=40))

[root@master-2022 bin]# systemctl status tomcat
● tomcat.service - Tomcat
   Loaded: loaded (/usr/lib/systemd/system/tomcat.service; disabled; vendor preset: disabled)
   Active: active (running) since Wed 2022-05-25 21:01:04 CST; 5s ago
  Process: 13510 ExecStart=/usr/local/tomcat/bin/catalina.sh start (code=exited, status=0/SUCCESS)
 Main PID: 13522 (java)
   CGroup: /system.slice/tomcat.service
           └─13522 /usr/bin/java -Djava.util.logging.config.file=/usr...

May 25 21:01:04 master-2022 systemd[1]: Starting Tomcat...
May 25 21:01:04 master-2022 catalina.sh[13510]: Tomcat started.
May 25 21:01:04 master-2022 systemd[1]: Started Tomcat.</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">JavaWeb环境测试</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 创建网站根目录
mkdir -p /data/wwwroot/default
echo 'Tomcat test' &gt; /data/wwwroot/default/index.jsp
chown -R www.www /data/wwwroot</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">配置nginx配置文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt; EOF &gt; /etc/nginx/conf.d/tomcat.conf
upstream nameserver {
    server 10.0.2.20:8080;
}
server{
    listen       9980 default_server;
    server_name  tomcat.master.com;
    location / {
    proxy_pass http://nameserver;
    proxy_set_header Host \$host;
    }
}
EOF

# 重启nginx
nginx -t &amp;&amp; nginx -s reload</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">测试</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@master-2022 bin]# curl 127.0.0.1:9980
HTTP/1.1 200
Set-Cookie: JSESSIONID=68ABB16FBD9C3E8C65A2C89668EDEF74; Path=/; HttpOnly
Content-Type: text/html;charset=ISO-8859-1
Content-Length: 12
Date: Wed, 25 May 2022 13:03:21 GMT

Tomcat test</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ElasticSearch_chapter">14. ElasticStack</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_elk环境配置">14.1. ELK环境配置</h3>
<div class="paragraph">
<p><strong>CentOS7</strong></p>
</div>
<div class="listingblock">
<div class="title">安装Java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum install -y java-11-openjdk java-11-openjdk-devel java-11-openjdk-headless</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">增加YUM源</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch

cat &lt;&lt; EOF &gt; /etc/yum.repos.d/elasticsearch.repo
[elasticsearch]
name=Elasticsearch repository for 7.x packages
baseurl=https://artifacts.elastic.co/packages/7.x/yum
gpgcheck=1
gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch
enabled=0
autorefresh=1
type=rpm-md
EOF</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_elasticsearch">14.1.1. ElasticSearch</h4>
<div class="listingblock">
<div class="title">安装</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum --disablerepo="*" --enablerepo="elasticsearch" install -y elasticsearch</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">配置</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sed -i '17s/#cluster.name: my-application/cluster.name: myapp/' /etc/elasticsearch/elasticsearch.yml
sed -i '23s/#node.name: node-1/node.name: node-1/' /etc/elasticsearch/elasticsearch.yml
sed -i '56s/#network.host: 192.168.0.1/network.host: 0.0.0.0/' /etc/elasticsearch/elasticsearch.yml
sed -i '70s/#discovery.seed_hosts: .*/discovery.seed_hosts: ["0.0.0.0\/0"]/' /etc/elasticsearch/elasticsearch.yml
sed -i '74s/#cluster.initial_master_nodes: .*/cluster.initial_master_nodes: ["node-1"]/' /etc/elasticsearch/elasticsearch.yml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">开机启动</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl enable elasticsearch</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">启动服务</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl start elasticsearch</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kibana">14.1.2. Kibana</h4>
<div class="listingblock">
<div class="title">安装</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum --disablerepo="*" --enablerepo="elasticsearch" install -y kibana</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">配置</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sed -i '7s/#server.host: "localhost"/server.host: "0.0.0.0"/' /etc/kibana/kibana.yml
sed -i '32s/#elasticsearch.hosts: .*/elasticsearch.hosts: ["http:\/\/0.0.0.0:9200"]/' /etc/kibana/kibana.yml
sed -i '115s/#i18n.locale: "en"/i18n.locale: "en"/' /etc/kibana/kibana.yml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">开机启动</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl enable kibana</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">启动服务</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl start kibana</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">最后</div>
<p>如果系统IP为 172.24.109.12，则访问 <a href="http://172.24.109.12:5601/" class="bare">http://172.24.109.12:5601/</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_logstash">14.1.3. LogStash</h4>
<div class="listingblock">
<div class="title">安装</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum --disablerepo="*" --enablerepo="elasticsearch" install -y logstash</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">测试</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF&gt; /etc/logstash/conf.d/test.conf
input { stdin { } }

output {
  elasticsearch { hosts =&gt; ["127.0.0.1:9200"] }
  stdout { codec =&gt; rubydebug }
}
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">1. 用命令行方式启动logstash

/usr/share/logstash/bin/logstash  -f /etc/logstash/conf.d/test.conf


2. 通过stdin输入，观察logstash。如输入：“this is a test”，会有如下输出
{
      "@version" =&gt; "1",
       "message" =&gt; "this is test",
          "host" =&gt; "slave-2022",
    "@timestamp" =&gt; 2022-05-26T13:49:06.697Z
}

3. 查看索引 curl -s "127.0.0.1:9200/_cat/indices?v"
health status index                           uuid                   pri rep docs.count docs.deleted store.size pri.store.size
yellow open   logstash-2022.05.27-000001      jUvsxcK1RVSUv1EVvSZqVw   1   1          1            0      4.6kb          4.6kb

4.发现有一个新索引logstash-2022.05.27-000001，查看新索引的内容
curl -XGET '127.0.0.1:9200/logstash-2022.05.27-000001/_doc/_search/?pretty'


5.删除测试文件
rm -f /etc/logstash/conf.d/test.conf</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_nginx日志分析">14.2. Nginx日志分析</h3>
<div class="listingblock">
<div class="title">Nginx日志格式</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">log_format  main  '$host $server_port $remote_addr - $remote_user [$time_local] "$request" '
                '$status $request_time $body_bytes_sent "$http_referer" '
                '"$http_user_agent" "$http_x_forwarded_for"';</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://www.elastic.co/guide/en/kibana/7.14/xpack-grokdebugger.html">Gork表达式</a></p>
</div>
<div class="sect3">
<h4 id="_filebeat实时导入">14.2.1. FileBeat实时导入</h4>
<div class="paragraph">
<p>Filebeat会把日志传送到Logstash，Logstash再把日志传到ES</p>
</div>
<div class="listingblock">
<div class="title">安装</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.17.4-x86_64.rpm
rpm -vi filebeat-7.17.4-x86_64.rpm</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">配置</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sed -i '7s/#server.host: "localhost"/server.host: "0.0.0.0"/' /etc/kibana/kibana.yml
sed -i '28s/false/true/' /etc/filebeat/filebeat.yml
sed -i '32s/*.log/nginx\/access*.log/' /etc/filebeat/filebeat.yml
sed -i '135s/^/#/' /etc/filebeat/filebeat.yml
sed -i '137s/^/#/' /etc/filebeat/filebeat.yml
sed -i '148s/#//' /etc/filebeat/filebeat.yml
sed -i '150s/#//' /etc/filebeat/filebeat.yml
sed -i '67s/#//' /etc/filebeat/filebeat.yml
sed -i '150s/localhost:5044/127.0.0.1:5400/' /etc/filebeat/filebeat.yml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">开机启动</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl enable filebeat</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">启动服务</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl start filebeat</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Nginx日志格式</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">log_format  main   '$host $server_port $remote_addr - $remote_user [$time_local] "$request" '
                      '$status $request_time $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">验证</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF&gt; /etc/logstash/conf.d/nginx-es.conf
input {
        beats {
                host =&gt; "0.0.0.0"
                port =&gt; 5400	# 对应在filebeat的配置中，output到logstash的5400端口
        }
}
filter{
        grok{
                match =&gt; { "message" =&gt; "%{IPORHOST:host_ip} %{NUMBER:server_port} %{IPORHOST:remote_ip} - %{DATA:remote_user} \[%{HTTPDATE:time_local}\] \"%{WORD:request_method} %{DATA:url} HTTP/%{NUMBER:http_version}\" %{NUMBER:status} %{NUMBER:request_time} %{NUMBER:body_bytes_sent} \"%{DATA:http_referrer}\" \"%{DATA:http_user_agent}\"" }
        }
        date {
                match =&gt; [ "time_local", "dd/MMM/yyyy:HH:mm:ss Z" ]
        }
}
output {
        elasticsearch {
                hosts =&gt; ["0.0.0.0:9200"]
                index =&gt; "nginx_es-%{+YYYY.MM.dd}"
        }
}
EOF

# 检查配置文件语法是否有错误
/usr/share/logstash/bin/logstash --config.test_and_exit -f /etc/logstash/conf.d/nginx-es.conf/nginx-es.conf</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">启动logstash服务</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl start logstash</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">查看索引</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -s "127.0.0.1:9200/_cat/indices?v"
yellow open   nginx_es-2022.05.27     RPDzQQbARqWXNzaCvxsI2w   1   1         33            0     32.6kb         32.6kb
检查ES内容，发现ES已自动创建索引nginx_es-2022.05.27并且已经有Nginx日志内容
curl -XGET '127.0.0.1:9200/nginx_es-2022.05.27/_doc/_search/?pretty'</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_nginx日志普通导入">14.2.2. Nginx日志普通导入</h4>
<div class="paragraph">
<p><strong>准备日志文件</strong></p>
</div>
<div class="paragraph">
<p>日志文件存放路径: <code>~/es_log/nginx_logs</code></p>
</div>
<div class="listingblock">
<div class="title">配置文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir -p ~/es_log/nginx_logs

cat &lt;&lt; EOF &gt; ~/es_log/logstash.conf
input{
  file {
    path =&gt; "${HOME}/es_log/nginx_logs/access.log*"
    type =&gt; "nginx_access"
    start_position =&gt; "beginning"
    sincedb_path =&gt; "/dev/null"
    stat_interval =&gt; "1 second"
  }
}
filter{
        grok{
                match =&gt; { "message" =&gt; "%{IPORHOST:host_ip} %{NUMBER:server_port} %{IPORHOST:remote_ip} - %{DATA:remote_user} \[%{HTTPDATE:time_local}\] \"%{WORD:request_method} %{DATA:url} HTTP/%{NUMBER:http_version}\" %{NUMBER:status} %{NUMBER:request_time} %{NUMBER:body_bytes_sent} \"%{DATA:http_referrer}\" \"%{DATA:http_user_agent}\"" }
        }
        date {
                match =&gt; [ "time_local", "dd/MMM/yyyy:HH:mm:ss Z" ]
        }
}
output {
        elasticsearch {
                hosts =&gt; ["0.0.0.0:9200"]
                index =&gt; "nginx_es_log-%{+YYYY.MM.dd}"
        }
        #file  {
        #    path =&gt; "/var/log/logstash.log"
        #    codec =&gt; json
        #}
}
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">导入数据到ES：</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/usr/share/logstash/bin/logstash -f ~/es_log/logstash.conf</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Docker_chapter">15. Docker</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_安装_6">15.1. 安装</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">官方文档</dt>
<dd>
<p><a href="https://docs.docker.com" class="bare">https://docs.docker.com</a></p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">向脚本文件追加内容</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt; EOF &gt; docker_install.sh
#Uninstall old versions
yum -y remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine

#SET UP THE REPOSITORY
yum -y install yum-utils
yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo

#INSTALL DOCKER ENGINE
yum -y install docker-ce docker-ce-cli containerd.io
systemctl enable docker
systemctl start docker

#配置镜像加速
mkdir -p /etc/docker
echo "{" &gt; /etc/docker/daemon.json
echo   '  "registry-mirrors": ["https://ueeg7jo6.mirror.aliyuncs.com"]  '   &gt;&gt; /etc/docker/daemon.json
echo "}" &gt;&gt; /etc/docker/daemon.json

#配置端口转发
echo 1 &gt; /proc/sys/net/ipv4/ip_forward

#重载Docker，使配置生效
systemctl daemon-reload
systemctl restart docker
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">给脚本授予执行权限</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">chmod +x docker_install.sh</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">执行脚本</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh docker_install.sh</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">测试</div>
<p>执行: <code>docker run hello-world</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">[ylighgh@docker ~]# docker run hello-world

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
    (amd64)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_基本使用">15.2. 基本使用</h3>
<div class="listingblock">
<div class="title">拉取镜像</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker pull [选项] [Docker Registry 地址[:端口号]/]仓库名[:标签]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">运行</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker run -itd --name myubuntu test/ubuntu:v1.0 /bin/bash</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">批量删除容器</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker rm -f $(docker ps -qa)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">自动启动</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">--restart参数=
	no
		默认策略，在容器退出时不重启容器
	on-failure
		在容器非正常退出时（退出状态非0），才会重启容器
	on-failure:3
		在容器非正常退出时重启容器，最多重启3次
	always
		在容器退出时总是重启容器
#开机自启
	unless-stopped
		在容器退出时总是重启容器，但是不考虑在Docker守护进程启动时就已经停止了的容器
# 一般推荐使用always参数
	--restart=always</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">将正在运行的容器设为自启动</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># docker update --restart=always 容器名或容器ID
docker update --restart=always &lt;CONTAINER ID&gt;
# 例如将tomcat设为自启动
docker update --restart=always tomcat</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">将自启动的容器取消自启动</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># docker update --restart=no 容器名或容器ID
docker update --restart=no &lt;CONTAINER ID&gt;
# 例如取消tomcat的自启动
docker update --restart=no tomcat</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">导入导出容器</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 导出容器
docker export 容器ID &gt; 文件名.tar.gz

# 导入容器
cat 文件名.tar.gz |docker import - 镜像用户/镜像名:版本号</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">提交容器</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker commit -m "描述信息" -a="作者" 容器ID 要创建的镜像名:[标签名]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_私服镜像">15.3. 私服镜像</h3>
<div class="listingblock">
<div class="title">下载Docker Registry</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker pull registry</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">运行</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 默认情况,仓库创建在容器里的/var/lib/registry目录下,建议自行使用容器卷映射,方便于宿主机联调
docker run -d -p 5000:5000 -v $HOME/myregistry/:/tmp/registry --privileged=true --restart=always registry</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">发送GET请求验证</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -XGET http://localhost:5000/v2/_catalog</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">修改tag名</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker tag myubunyu:v1 192.168.43.205:5000/myubuntu:v1.1</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">修改配置文件使之支持http</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sed -i '2s/$/,/' /etc/docker/daemon.json
sed -i '2 a \"insecure-registries\":[\"192.168.43.205:5000\"]' /etc/docker/daemon.json</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">重启Docker</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl daemon-reload
systemctl restart docker</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">推送镜像到私服库</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker push 192.168.43.205:5000/myubuntu:v1.1</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">测试拉取</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker pull 192.168.43.205:5000/myubuntu:v1.1</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">结果</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">[root@nginx ~]# docker images
REPOSITORY                                              TAG       IMAGE ID       CREATED         SIZE
192.168.43.205:5000/myubuntu                            v1.1      8ee699689cc3   2 hours ago     111MB
registry.cn-hangzhou.aliyuncs.com/ylighgh/myubuntu_v1   1.1       f909f58557c6   5 hours ago     178MB
nginx                                                   latest    605c77e624dd   5 months ago    141MB
tomcat                                                  latest    fb5657adc892   6 months ago    680MB
registry                                                latest    b8604a3fe854   7 months ago    26.2MB
ubuntu                                                  latest    ba6acccedd29   8 months ago    72.8MB
hello-world                                             latest    feb5d9fea6a5   9 months ago    13.3kB
redis                                                   6.0.8     16ecd2772934   20 months ago   104MB</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_容器数据卷">15.4. 容器数据卷</h3>
<div class="paragraph">
<div class="title">挂载文件</div>
<p>需要持久化的数据: 日志 配置文件 业务数据 临时缓存数据</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker run -it --privileged=true -v /宿主机绝对路径:/容器内目录 镜像名</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">容器卷继承</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker run -it --privileged=true -volumes-from 容器名1 --name 容器名2 镜像名</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_程序启动命令汇总">15.5. 程序启动命令汇总</h3>
<div class="sect3">
<h4 id="_tomcat_2">15.5.1. Tomcat</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker run -d -p 8080:8080 --name mytomcat8 billygoo/tomcat8-jdk8</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_redis">15.5.2. Redis</h4>
<div class="listingblock">
<div class="title">准备配置文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir -p /docker/redis/

wget https://raw.githubusercontent.com/antirez/redis/6.0.8/redis.conf -O /docker/redis/redis.conf</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">启动</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker run -p 6379:6379 --privileged=true \
-v /docker/redis/redis.conf:/etc/redis/redis.conf \
-v /docker/redis/data:/data \
-v /etc/localtime:/etc/localtime \
-d redis:6.0.8 redis-server /etc/redis/redis.conf</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mysql">15.5.3. MySQL</h4>
<div class="listingblock">
<div class="title">修改默认字符</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF&gt; /docker/mysql/conf/my.cnf
[client]
default_character_set = utf8
[mysqld]
collation_server = utf8_general_ci
character_set_server = utf8
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">启动</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker run -p 3306:3306 --privileged=true \
-v /docker/mysql/log:/var/log/mysql \
-v /docker/mysql/data:/var/lib/mysql \
-v /docker/mysql/conf:/etc/mysql/conf.d \
-v /etc/localtime:/etc/localtime \
-e MYSQL_ROOT_PASSWORD=my-secret-pw \
-d mysql:5.7</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mysql主从">15.6. MySQL主从</h3>
<div class="sect3">
<h4 id="_主节点配置">15.6.1. 主节点配置</h4>
<div class="listingblock">
<div class="title">环境准备</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir -p /docker/mysql-master/conf</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">启动MySQL-master</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker run -d -p 3307:3306 --name mysql-master --privileged=true \
-v /docker/mysql-master/log:/var/log/mysql \
-v /docker/mysql-master/data:/var/lib/mysql \
-v /docker/mysql-master/conf:/etc/mysql/conf.d \
-v /etc/localtime:/etc/localtime \
-e MYSQL_ROOT_PASSWORD=123456 \
-d mysql:5.7</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">配置文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF&gt; /docker/mysql-master/conf/my.cnf
[client]
default_character_set = utf8
[mysqld]
# 设置字符集
collation_server = utf8_general_ci
character_set_server = utf8
# 设置server_id(唯一)
server_id=101
# 指定不需要同步的数据库
binlog-ignore-db = mysql
# 记录操作日志
log-bin=mysql-bin
# 设置二进制日志使用内存大小
binlog_cache_size=1M
# 设置使用的二进制日志格式(mixed,statement,row)
binlog_format=mixed
# 二进制日志过期清理时间
expire_logs_days=7
# 忽略错误 主键重复
slave_skip_errors=1062
EOF

#### 重启使配置文件生效
docker restart mysql-master</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">数据库配置</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 进入容器内部
docker exec -it mysql-master bash
# 执行命令
mysql -uroot -p123456 -e 'grant replication slave on *.* to slave@"%" identified by "123456";flush privileges;show master status;'</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_从节点配置">15.6.2. 从节点配置</h4>
<div class="listingblock">
<div class="title">环境准备</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir -p /docker/mysql-slave/conf</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">启动MySQL-slave</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker run -d -p 3308:3306 --name mysql-slave --privileged=true \
-v /docker/mysql-slave/log:/var/log/mysql \
-v /docker/mysql-slave/data:/var/lib/mysql \
-v /docker/mysql-slave/conf:/etc/mysql/conf.d \
-v /etc/localtime:/etc/localtime \
-e MYSQL_ROOT_PASSWORD=123456 \
-d mysql:5.7</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">配置文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF&gt; /docker/mysql-slave/conf/my.cnf
[client]
default_character_set = utf8
[mysqld]
# 设置字符集
collation_server = utf8_general_ci
character_set_server = utf8
# 设置server_id(唯一)
server_id=102
# 指定不需要同步的数据库
binlog-ignore-db = mysql
# 记录操作日志
log-bin=mysql-slave1-bin
# 设置二进制日志使用内存大小
binlog_cache_size=1M
# 设置使用的二进制日志格式(mixed,statement,row)
binlog_format=mixed
# 二进制日志过期清理时间
expire_logs_days=7
# 忽略错误 主键重复
slave_skip_errors=1062
# relay_log配置中继日志
relay_log=mysql-relay-bin
# log_slave_updates表示将slave复制事件写进自己的二进制日志
log_slave_updates=1
# slave设置为只读
read_only=1
EOF

### 重启mysql使配置文件生效
docker restart mysql-slave</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">数据库配置</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 进入容器内部
docker exec -it mysql-slave bash
# 执行命令
mysql -uroot -p123456 -e 'change master to master_host="IP",master_user="slave",master_password="123456",master_port=3307,master_log_file="xxxx",master_log_pos=xxxx;start slave;flush privileges;'</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dockerfile">15.7. DockerFile</h3>
<div class="listingblock">
<div class="title">构建</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker build -d 新镜像名字:TAG .</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">CentOS7JDK11脚本</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">FROM centos:centos7
MAINTAINER ylighgh&lt;yssuvu@gmail.com&gt;

ENV MYPATH /usr/local
WORKDIR $MYPATH

RUN yum -y update
RUN yum -y install vim
RUN yum -y install net-tools
RUN mkdir /usr/local/java
ADD jdk-11.0.15.1_linux-x64_bin.tar.gz /usr/local/java
ENV JAVA_HOME /usr/local/java/jdk-11.0.15.1
ENV CLASSPATH $JAVA_HOME/lib/tools.jar:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib
ENV PATH $JAVA_HOME/bin:$PATH


CMD echo $MYPATH
CMD echo "sucess------ok"
CMD /bin/bash</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_docker网络">15.8. Docker网络</h3>
<div class="listingblock">
<div class="title">新建桥接网络</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker network create my_network</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">查看网络</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker network ls

[root@nginx ~]# docker network  ls
NETWORK ID     NAME         DRIVER    SCOPE
09b399066c7f   bridge       bridge    local
e6561971bc9b   host         host      local
ba98f0f4f1df   my_network   bridge    local
e50b1a449286   none         null      local</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">将容器加入至网络</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker run -d -p 8081:8080 --network my_network --name tomcat81 billygoo/tomcat8-jdk8</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_compose">15.9. Compose</h3>
<div class="paragraph">
<p><a href="https://docs.docker.com/compose/">官方文档</a></p>
</div>
<div class="sect3">
<h4 id="_安装_7">15.9.1. 安装</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 下载
curl -SL https://github.com/docker/compose/releases/download/v2.6.1/docker-compose-linux-x86_64 -o /usr/local/bin/docker-compose
# 授予执行权限
chmod +x /usr/local/bin/docker-compose
# 创建软链接
ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
# 检测
docker-compose --version</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jenkins">15.9.2. Jenkins</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir -p /usr/local/docker/jenkins_docker/data
chmod -R 777 /usr/local/docker/jenkins_docker/data
cat &lt;&lt;EOF&gt; /usr/local/docker/jenkins_docker/docker-compose
version: "3.1"
services:
   jenkins:
       image: jenkins/jenkins:2.319.1-lts
       container_name: jenkins
       ports:
          - 8080:8080
          - 50000:50000
       volumes:
          - ./data:/var/jenkins_home/
EOF
cd /usr/local/docker/jenkins_docker &amp;&amp; docker-compose up -d</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sonarqube">15.9.3. SonarQube</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">echo "vm.max_map_count=262144" &gt;&gt; /etc/sysctl.conf
sysctl -p
mkdir -p /usr/local/docker/sonarqube_docker
chmod -R /usr/local/docker/sonarqube_docker
cat &lt;&lt;EOF&gt; /usr/local/docker/sonarqube_docker/docker-compose
version: "3.1"
services:
  db:
    image: postgres
    container_name: db
    ports:
      - 5432:5432
    networks:
      - sonarnet
    environment:
      POSTGRES_USER: sonar
      POSTGRES_PASSWORD: sonar
  sonarqube:
    image: sonarqube:8.9.6-community
    container_name: sonarqube
    depends_on:
      - db
    ports:
      - 9000:9000
    networks:
      - sonarnet
    environment:
      SONAR_JDBC_URL: jdbc:postgresql://db:5432/sonar
      SONAR_JDBC_USERNAME: sonar
      SONAR_JDBC_PASSWORD: sonar
networks:
  sonarnet:
    driver: bridge
EOF
cd /usr/local/docker/sonarqube_docker &amp;&amp; docker-compose up -d</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Maven_chapter">16. Maven</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_安装_8">16.1. 安装</h3>
<div class="paragraph">
<p><a href="https://maven.apache.org/download.cgi">下载地址</a></p>
</div>
<div class="listingblock">
<div class="title">下载</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">wget -c https://dlcdn.apache.org/maven/maven-3/3.8.6/binaries/apache-maven-3.8.6-bin.tar.gz</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">解压</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">tar xf apache-maven-3.8.6-bin.tar.gz -C /usr/local

mv /usr/local/apache-maven-3.8.6 /usr/local/maven</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">配置环境变量</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#添加环境变量
ln -s /usr/local/maven/bin/mvn /usr/local/bin/

#查看版本
mvn -v</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">修改setting.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&lt;mirror&gt;
    &lt;id&gt;aliyun&lt;/id&gt;
    &lt;name&gt;Aliyun Central&lt;/name&gt;
    &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;
    &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;
&lt;/mirror&gt;

&lt;profile&gt;
    &lt;id&gt;jdk18&lt;/id&gt;
    &lt;activation&gt;
        &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
        &lt;jdk&gt;1.8&lt;/jdk&gt;
    &lt;/activation&gt;
    &lt;properties&gt;
        &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;
        &lt;maven.compiler.compilerVersion&gt;1.8&lt;/maven.compiler.compilerVersion&gt;
    &lt;/properties&gt;
&lt;/profile&gt;


&lt;activeProfiles&gt;
    &lt;activeProfile&gt;jdk8&lt;/activeProfile&gt;
&lt;/activeProfiles&gt;</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Harbor_chapter">17. Harbor</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_安装_9">17.1. 安装</h3>
<div class="paragraph">
<p><a href="https://github.com/goharbor/harbor/releases">下载地址</a></p>
</div>
<div class="listingblock">
<div class="title">下载</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">wget -c https://github.com/goharbor/harbor/releases/download/v2.3.4/harbor-offline-installer-v2.3.4.tgz</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">解压</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">tar xf harbor-offline-installer-v2.3.4.tgz -C /usr/local</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">修改配置</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 进入文件夹
cd /usr/local/harbor
# 备份默认配置文件
cp -a harbor.yml.tmpl harbor.yml

# 修改地址
sed -i '5s/reg.mydomain.com/192.168.0.150/' harbor.yml

# 注释https
sed -i '13s/^/#/' harbor.yml
sed -i '15s/^/#/' harbor.yml
sed -i '17s/^/#/' harbor.yml
sed -i '18s/^/#/' harbor.yml

# 查看harbor默认密码
sed -n '34,34p' harbor.yml


# 安装
./install.sh


# 修改配置daemon文件
sed -i '2s/$/,/' /etc/docker/daemon.json
sed -i '2 a \"insecure-registries\":[\"192.168.0.150:80\"]' /etc/docker/daemon.json

# 重启docker
systemctl daemon-reload
systemctl restart docker</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_使用">17.2. 使用</h3>
<div class="listingblock">
<div class="title">推送镜像</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 登陆docker仓库
docker login -u admin -p Harbor12345 192.168.0.150:80

# 修改镜像格式
harbor地址/仓库名/镜像名:版本号

docker tag 64f770dda7e1 192.168.0.150:80/repo/mytest:v2.0.0

# 推送镜像
docker push 192.168.0.150:80/repo/mytest:v2.0.0

# 拉取镜像
docker pull 192.168.0.150:80/repo/mytest:v2.0.0</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Ceph_chapter">18. Ceph</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_安装_10">18.1. 安装</h3>
<div class="listingblock">
<div class="title">添加依赖</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum -y install python-setuptools</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">添加Ceph仓库</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">CEPH_STABLE_RELEASE=nautilus

cat  &lt;&lt; EOF &gt; /etc/yum.repos.d/ceph.repo
[Ceph]
name=Ceph packages for \$basearch
baseurl=https://mirrors.aliyun.com/ceph/rpm-${CEPH_STABLE_RELEASE}/el7/\$basearch
enabled=1
gpgcheck=1
type=rpm-md
gpgkey=https://mirrors.aliyun.com/ceph/keys/release.asc

[ceph-noarch]
name=Ceph noarch packages
baseurl=https://mirrors.aliyun.com/ceph/rpm-${CEPH_STABLE_RELEASE}/el7/noarch
enabled=1
gpgcheck=1
type=rpm-md
gpgkey=https://mirrors.aliyun.com/ceph/keys/release.asc

[ceph-source]
name=Ceph source packages
baseurl=https://mirrors.aliyun.com/ceph/rpm-${CEPH_STABLE_RELEASE}/el7/SRPMS/
enabled=1
gpgcheck=1
type=rpm-md
gpgkey=https://mirrors.aliyun.com/ceph/keys/release.asc
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">创建部署目录</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir -p ~/ceph-cluster &amp;&amp; cd ~/ceph-cluster</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">安装ceph-deploy</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum -y install ceph-deploy</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">创建集群</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ceph-deploy new node1 node2 node3 --public-network 10.0.2.0/24 --cluster-network 10.0.2.0/24</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">安装ceph</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 自动安装
ceph-deploy install node1 node2 node3

# 手动安装
yum -y install ceph ceph-radosgw</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">设置 MON 和 KEY</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ceph-deploy mon create-initial</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TIP</dt>
<dd>
<p>说明：执行完成后会在部署目录 <code>~/ceph-cluster/`</code> 下生成以下 <code>keyring</code> 文件</p>
<div class="ulist">
<ul>
<li>
<p>ceph.bootstrap-mds.keyring</p>
</li>
<li>
<p>ceph.bootstrap-mgr.keyring</p>
</li>
<li>
<p>ceph.bootstrap-osd.keyring</p>
</li>
<li>
<p>ceph.bootstrap-rgw.keyring</p>
</li>
<li>
<p>ceph.client.admin.keyring</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">将 ceph.client.admin.keyring 拷贝到各个节点上</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ceph-deploy --overwrite-conf admin node1 node2 node3</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TIP</dt>
<dd>
<p>拷贝之后的文件在节点上的 <code>/etc/ceph/</code></p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">安装MGR</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ceph-deploy mgr create node1 node2 node3</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">启动OSD</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 擦除硬盘
ceph-deploy disk zap node1 /dev/sdb
ceph-deploy disk zap node2 /dev/sdb
ceph-deploy disk zap node3 /dev/sdb

# 创建osd节点
ceph-deploy osd create node1 --fs-type xfs --data /dev/sdb
ceph-deploy osd create node2 --fs-type xfs --data /dev/sdb
ceph-deploy osd create node3 --fs-type xfs --data /dev/sdb</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">修改ceph.conf</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt; EOF &gt;&gt; ~/ceph-cluster/ceph.conf
mon_clock_drift_allowed = 2
mon_clock_drift_warn backoff = 30
EOF

ceph config set mon mon_warn_on_insecure_global_id_reclaim false
ceph config set mon mon_warn_on_insecure_global_id_reclaim_allowed false

ceph-deploy --overwrite-conf config push node{1,2,3}

systemctl restart ceph-mon.target</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">验证</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@node1 ceph-cluster]# ceph -s
  cluster:
    id:     a7074991-7a98-42b1-a517-891782210587
    health: HEALTH_OK

  services:
    mon: 3 daemons, quorum node1,node2,node3 (age 22s)
    mgr: node1(active, since 2m), standbys: node2, node3
    osd: 3 osds: 3 up (since 119s), 3 in (since 119s)

  data:
    pools:   0 pools, 0 pgs
    objects: 0 objects, 0 B
    usage:   3.0 GiB used, 13 GiB / 16 GiB avail
    pgs:</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_文件存储服务">18.2. 文件存储服务</h3>
<div class="listingblock">
<div class="title">启用MDS服务</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ceph-deploy mds create node1 node2 node3</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">创建文件存储池</div>
<p>建两个存储池，<code>cephfs_metadata</code> 用于存文件系统元数据，<code>cephfs_data</code> 用于存文件系统数据</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ceph osd pool create cephfs_metadata 32 32
ceph osd pool create cephfs_data 32 32

# 启用
ceph osd pool application enable cephfs_metadata cephfs
ceph osd pool application enable cephfs_data cephfs</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">创建文件系统</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ceph fs new koenlifs cephfs_metadata cephfs_data</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">验证挂载</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir -p /ceph/cephfs

# 方式一 mount
mount -t ceph node1:6789,node2:6789,node3:6789:/ /ceph/cephfs -o name=admin,secret=AQAZUhdj3ruKHhAAt5E5YdYhfGXUpnorM0VBDw==


# 方式二 ceph-fuse
yum -y install ceph-fuse

ceph-fuse -n client.admin -m node1:6789,node2:6789,node3:6789 /ceph/cephfs


[root@node2 cephfs]# df -h
Filesystem                                      Size  Used Avail Use% Mounted on
devtmpfs                                        988M     0  988M   0% /dev
tmpfs                                          1000M     0 1000M   0% /dev/shm
tmpfs                                          1000M  8.6M  991M   1% /run
tmpfs                                          1000M     0 1000M   0% /sys/fs/cgroup
/dev/mapper/centos-root                          17G  1.8G   16G  11% /
/dev/sda1                                      1014M  136M  879M  14% /boot
tmpfs                                           200M     0  200M   0% /run/user/0
tmpfs                                          1000M   52K 1000M   1% /var/lib/ceph/osd/ceph-1
10.0.2.10:6789,10.0.2.20:6789,10.0.2.30:6789:/  3.8G     0  3.8G   0% /ceph/cephfs</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">取消挂载</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">umount /ceph/cephfs</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TIP</dt>
<dd>
<p>secret 在 /etc/ceph/ceph.client.admin.keyring</p>
</dd>
</dl>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Libvirt_chapter">19. Libvirt</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_安装配置_2">19.1. 安装配置</h3>
<div class="sect3">
<h4 id="_安装kvm环境">19.1.1. 安装kvm环境</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Archlinux
sudo pacman -S virt-manager qemu-system-x86 vde2 ebtables dnsmasq bridge-utils openbsd-netcat qemu-base</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># lsmod | grep kvm

kvm_intel       138567  0
kvm             441119  1 kvm_intel</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl enable --now libvirtd

# 设置端口转发
echo "net.ipv4.ip_forward = 1" &gt;&gt; /etc/sysctl.conf
sysctl -p</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">验证</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ip a
4: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000
    link/ether 52:54:00:d6:75:36 brd ff:ff:ff:ff:ff:ff
    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0
       valid_lft forever preferred_lft forever</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_安装虚拟机">19.2. 安装虚拟机</h3>
<div class="sect3">
<h4 id="_准备镜像文件">19.2.1. 准备镜像文件</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">qemu-img create -f qcow2 /home/ylighgh/libvirt/images/ubuntu-22.04.img 10G</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_增加虚拟机">19.2.2. 增加虚拟机</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">virt-install \
--name ubuntu-22.04 \
--ram 4096 \
--disk path=/home/ylighgh/libvirt/images/ubuntu-22.04.img,size=10 \
--vcpus 2 \
--os-type linux \
--os-variant ubuntu22.04 \
--network bridge=virbr0 \
--console pty,target_type=serial \
--cdrom=/home/ylighgh/Downloads/ubuntu-22.04.1-live-server-amd64.iso \
--graphics vnc,password=123123,port=15424,listen=0.0.0.0

# 从已经存在的镜像文件(tpl_win2k12r2.img)创建虚拟机
virt-install \
--name tpl_win2k12r2 \
--ram 4048 \
--disk path=/data/libvirt/images/tpl_win2k12r2.img \
--vcpus 4 \
--os-type windows \
--os-variant win2k12r2 \
--network bridge=virbr0 \
--console pty,target_type=serial \
--import \
--graphics vnc,password=aC8W5It9nOyrXchH,port=-1,listen=0.0.0.0</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_常用命令_4">19.3. 常用命令</h3>
<div class="sect3">
<h4 id="_增加硬盘">19.3.1. 增加硬盘</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 准备磁盘文件
qemu-img create -f qcow2 web-add.qcow2 2G

# 临时添加
virsh attach-disk web /opt/web-add.qcow2 vdb --subdriver qcow2

# 永久添加
virsh attach-disk web /opt/web-add.qcow2 vdb --subdriver qcow2  --config

# 分离磁盘
virsh detach-disk web vdb</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">查看磁盘信息</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">virsh domblklist [VM_Name]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_快照">19.3.2. 快照</h4>
<div class="listingblock">
<div class="title">创建快照</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo virsh snapshot-create-as \
--domain [VM_Name] \
--name [Snapshot_Name] \
--description "first snapshot" \
--atomic</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">查看快照</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">virsh snapshot-list --domain [VM_Name]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">删除快照</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">virsh snapshot-delete --domain [VM_Name] [Snapshot_Name]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">还原快照</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">virsh snapshot-revert --domain [VM_Name] --snapshotname [SnapShot_Name]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_镜像文件扩容">19.4. 镜像文件扩容</h3>
<div class="listingblock">
<div class="title">增加镜像文件大小</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 增加2G
qemu-img resize /home/ylighgh/workspace/libvirt/images/qemu-add.qcow2 +2G</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>确认容量</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">qemu-img info qemu-add.qcow2

$ qemu-img info qemu-add.qcow2
image: qemu-add.qcow2
file format: qcow2
virtual size: 4 GiB (4294967296 bytes)
disk size: 2.2 MiB
cluster_size: 65536
Format specific information:
    compat: 1.1
    compression type: zlib
    lazy refcounts: false
    refcount bits: 16
    corrupt: false
    extended l2: false</code></pre>
</div>
</div>
<div class="dlist">
<div class="title">重建分区</div>
<dl>
<dt class="hdlist1">TIP</dt>
<dd>
<p>如果没有分区，跳过此步</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>查看分区</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">parted -s /dev/vdb unit s pr</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>输出</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ylighgh@kvm:~$ sudo parted -s /dev/vdb unit s pr
Model: Virtio Block Device (virtblk)
Disk /dev/vdb: 8388608s
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start  End       Size      Type     File system  Flags
 1      2048s  4194303s  4192256s  primary  ext4

其中8388608s为扇区总大小</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>添加分区设备映射</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kpartx -a /dev/vdb</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>获取分区设备映射文件名</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ls /dev/mapper/vdb*

ylighgh@kvm:~$ sudo ls /dev/mapper/vdb*
/dev/mapper/vdb1</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>检查文件 Ext 文件系统</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">e2fsck -fy /dev/mapper/vdb1</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>转换 Ext3/4 为 Ext2</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>移除 Ext3/4 日志后，相当于 Ext2。</p>
</div>
<div class="paragraph">
<p>ext3 &#8594; ext2, ext3 - journal = ext2</p>
</div>
<div class="paragraph">
<p>ext4 &#8594; (ext2 + ext4 features), ext4 - journal = ext2 + ext4 features</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">tune2fs -O ^has_journal /dev/mapper/vdb1</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>删除分区设备映射</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kpartx -d /dev/vdb</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>删除待扩容分区</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">parted -s /dev/vdb rm 1</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>重建分区</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>镜像尾部保留一小部分空间，扇区总数量 - 3000 = 8385608</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">parted -s /dev/vdb unit s mkpart primary ext4 2048 8385608s</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>确认分区</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">parted -s /dev/vdb unit s pr</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">输出：</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console"># parted -s /dev/vdb unit s pr
Model: Virtio Block Device (virtblk)
Disk /dev/vdb: 8388608s
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start  End       Size      Type     File system  Flags
 1      2048s  8385608s  8383561s  primary  ext2</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>设置启动分区</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>如果处理的分区之前是启动分区，扩容后必须重新设置启动参数</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">parted -s /dev/vdb set 1 boot on</code></pre>
</div>
</div>
<div class="dlist">
<div class="title">重建文件系统</div>
<dl>
<dt class="hdlist1">TIP</dt>
<dd>
<p>如果没有文件系统，跳过此步</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">添加分区设备映射</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kpartx -a /dev/vdb</code></pre>
</div>
</div>
<div class="olist arabic">
<div class="title">Ext2/3/4</div>
<ol class="arabic">
<li>
<p>调整 Ext 文件系统大小</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">resize2fs -f /dev/mapper/vdb1</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>增加 Ext3 日志到文件系统</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Ext2 + journal = ext3</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">tune2fs -j /dev/mapper/vdb1</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">tune2fs -O has_journal /dev/mapper/vdb1</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>检查文件 Ext 文件系统</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">e2fsck -fy /dev/mapper/vdb1</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">删除分区设备映射</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kpartx -d /dev/vdb</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">验证</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># parted -s /dev/vdb unit s pr
Model: Virtio Block Device (virtblk)
Disk /dev/vdb: 8388608s
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start  End       Size      Type     File system  Flags
 1      2048s  8385608s  8383561s  primary  ext4</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Btrfs_chapter">20. Btrfs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_基本使用_2">20.1. 基本使用</h3>
<div class="listingblock">
<div class="title">写入文件系统</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkfs.btrfs /path/to/device</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">挂载</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mount /dev/vdc1 /backup/

# 指定选项挂载(man 5 btrfs)
mount -o option1,option2 /dev/vdc1 /backup/

# 将多个硬盘合并成一个文件系统
mount -L mydata /dev/vdd /dev/vde</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">查看大小</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">btrfs filesystem show /mydata

suse:~ # btrfs filesystem show /mydata/
Label: 'mydata'  uuid: f38e8548-402c-42be-8f1e-4bcd4d275cf5
        Total devices 2 FS bytes used 192.00KiB
        devid    1 size 2.00GiB used 272.00MiB path /dev/vdd
        devid    2 size 2.00GiB used 264.00MiB path /dev/vde</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">扩缩容</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">btrfs filesystem resize 2:[-|+|max]1G /mydata/</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">suse:~ # btrfs filesystem resize 2:-1G /mydata/
Resize device id 2 (/dev/vde) from 2.00GiB to 1.00GiB
suse:~ # btrfs filesystem show /mydata/
Label: 'mydata'  uuid: f38e8548-402c-42be-8f1e-4bcd4d275cf5
        Total devices 2 FS bytes used 192.00KiB
        devid    1 size 2.00GiB used 272.00MiB path /dev/vdd
        devid    2 size 1.00GiB used 264.00MiB path /dev/vde</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">添加/删除磁盘至btrfs</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">btrfs device add /dev/vdf /mydata

btrfs device delete /dev/vdf /mydata</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">转化</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 将ext4转换为btrfs
btrfs-convert /path/to/device

# 将btrfs回退至之前的文件系统
btrfs-convert -r /path/to/device</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">创建子卷</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">btrfs subvolume create xxx</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">查看子卷信息</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">btrfs subvolume show xxx</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">创建子卷快照</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">btrfs subvolume snapshot -r xxx xxx-bak</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">挂载子卷</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mount -o [subvol=xxx|subvolid=xxx] /dev/vdd /mnt/logs</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_增量备份">20.2. 增量备份</h3>
<div class="ulist">
<ul>
<li>
<p>/data (source side)</p>
</li>
<li>
<p>/backup/data (target side)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">初始化</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 测试文件
dd if=/dev/zero of=/data/test bs=1G count=1

btrfs sub snap -r /data /data/bkp_data &amp;&amp; sync

btrfs send /data/bkp_data | btrfs receive /backup</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">增量备份</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 测试文件
touch /data/test2

btrfs subvolume snapshot -r /data /data/bkp_data-2 &amp;&amp; sync

btrfs send -p /data/bkp_data /data/bkp_data-2 | btrfs receive /backup</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">最后</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">btrfs sub del /data/bkp_data
mv /data/bkp_data-2 /data/bkp_data
btrfs sub del /backup/bkp_data
mv /backup/bkp_data-2 /backup/bkp_data</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">发送到远程目录</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">btrfs send /data/bkp_data | ssh root@ubuntu 'btrfs receive /backup'</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-10-08 15:49:51 +0800
</div>
</div>
<script src="js/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="js/MathJax/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>