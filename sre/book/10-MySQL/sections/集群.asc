=== MySQL集群

==== 主从备份

[cols=2*] 
|===

|主节点
|10.0.2.20

|从节点
|10.0.2.30
|===

**主节点配置**

.修改 `my.cnf` 文件

[source,bash]
----
vim /etc/my.cnf
[mysqld]
#记录操作日志
log-bin=mysql-bin
#不同步mysql系统数据库
binlog_ignore_db = mysql
#数据库集群的节点id
server-id=20
----

.修改系统配置
[source,bash]
----
# 重启数据库服务，使配置文件生效
systemctl restart mariadb
# 在主节点创建一个user用户连接节点mysql2，并赋予从节点同步主节点数据库权限
mysql -uroot -pgeek -e 'grant replication slave on *.* to user@"10.0.2.30" identified by "geek";flush privileges;'
----


**从节点配置**

.修改 `my.cnf` 文件

[source,bash]
----
vim /etc/my.cnf
[mysqld]
#记录操作日志
log-bin=mysql-bin
#不同步mysql系统数据库
replicate-ignore-db=mysql
#数据库集群的节点id
server-id=30
----

.修改系统配置
[source,bash]
----
#重启数据库服务，使配置文件生效
systemctl restart mariadb
#配置从节点连接主节点的信息，并开启从节点服务
mysql -uroot -pgeek -e 'change master to master_host="10.0.2.20",master_user="user",master_password="geek";start slave;flush privileges;'
----